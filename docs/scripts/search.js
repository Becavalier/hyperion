const DEFAULT_INDEX=0,SEARCH_RESULT_THRESHOLD=15,escapeHTML=e=>{const t=document.createElement("p");return t.appendChild(document.createTextNode(e)),t.innerHTML};document.addEventListener("DOMContentLoaded",async()=>{const e={wrapSearchPostResultSnippet:e=>e.length>0&&(e.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),`\n          <h4>文章（仅显示最近 15 条）</h4>\n          <ul class="search-catelog-items">\n          ${e.slice(0,15).reduce((e,t)=>e+=`\n                <li itemprop="name">\n                  <a target="_blank" href="${t.url}" itemprop="url">\n                    <span>${t.title}</span>&nbsp;|&nbsp;<time itemprop="datePublished" datetime="${t.rawDate}">${t.date}</time>\n                  </a>\n                  <ul>${t.snippets.reduce((e,t)=>e+=`<li>... ${escapeHTML(t)} ...</li>`,"")}</ul>\n                </li>\n              `,"")}\n          </ul><br>\n        `)},t=document.querySelectorAll("div.search-result-container"),n=document.querySelector("input.input-search"),a=document.querySelector("div.no-result"),r=document.querySelector("button.submit-search");n.addEventListener("keydown",e=>{13===e.keyCode&&r.click()}),r.addEventListener("click",async r=>{const s=r.target||r.srcElement,c=n.value;if(c){s.disabled=!0,s.innerText="...";try{const n=await axios.get("/graphql",{params:{query:"\n  query searchContent($searchKey: String!) {\n    searchPostsByKey(key: $searchKey) {\n      title\n      url\n      date\n      rawDate\n      snippets\n    }\n  }\n            ",variables:{searchKey:c}}});if(Array.isArray(n.data.errors)&&n.data.errors.length>0)return void alert(n.data.errors[0].message);const{data:{data:{...l}}}=n,i=[];t.forEach(t=>{const{type:n}=t.dataset;i.push({html:e[`wrapSearch${n}ResultSnippet`].call(this,l[`search${n}sByKey`]),type:n})}),0===i.filter(e=>e.html).length?(t.forEach(e=>{e.innerHTML=""}),a.style.display="block"):(a.style.display="none",t.forEach(e=>{const{type:t}=e.dataset,{html:n}=i.filter(e=>e.type===t)[0];n&&(e.innerHTML="",e.insertAdjacentHTML("afterbegin",n))}))}catch(r){console.error(r.message)}finally{s.disabled=!1,s.innerText="搜索"}}})});