const loadScript=(e,t={})=>{const a=document.createElement("script");Object.entries(t).forEach(([e,t])=>{a[e]=t}),a.src=e,a.addEventListener("error",e=>{console.error(e.message)}),document.body.appendChild(a)},DEFAULT_INDEX=0,SEARCH_RESULT_THRESHOLD=15,SEARCH_INDEX="hangyu_site",urlParams=new URLSearchParams(document.currentScript.getAttribute("src").split("?")[1]),searchEndpoint=urlParams.get("endpoint");let algoliaSearchClient=null;"algolia"===searchEndpoint?loadScript("https://cdn.jsdelivr.net/npm/algoliasearch@4.19.1/dist/algoliasearch-lite.umd.js",{crossorigin:"anonymous",type:"text/javascript"}):loadScript("https://shadow.elemecdn.com/npm/axios@0.18.0/dist/axios.min.js",{type:"text/javascript"});const formatDate=e=>new Date(e).toLocaleDateString(),escapeHTML=e=>{const t=document.createElement("p");return t.appendChild(document.createTextNode(e)),t.innerHTML};document.addEventListener("DOMContentLoaded",async()=>{const e={wrapSearchPostResultSnippet:e=>e.length>0&&`\n          <h4>文章（仅显示相关的 15 条）</h4>\n          <ul class="search-catelog-items">\n          ${e.slice(0,15).reduce((e,t)=>e+=`\n                <li itemprop="name">\n                  <a target="_blank" href="${t.url||t.permalink}" itemprop="url">\n                    <span class="title">${t.title}</span>\n                    <span class="separator">|</span>\n                    <time itemprop="datePublished" datetime="${t.rawDate||t.date}">${formatDate(t.date)}</time>\n                  </a>\n                  <ul>${(t.snippets||[t.content]).reduce((e,t)=>e+=`<li>... ${escapeHTML(t)} ...</li>`,"")}</ul>\n                </li>\n              `,"")}\n          </ul><br>\n        `},t=document.querySelectorAll("div.search-result-container"),a=document.querySelector("input.input-search"),n=document.querySelector("div.no-result"),r=document.querySelector("button.submit-search");a.addEventListener("keydown",e=>{13===e.keyCode&&r.click()}),r.addEventListener("click",async r=>{const s=r.target||r.srcElement,i=a.value;if(i){s.disabled=!0,s.innerText="...";const a=[];try{if("algolia"===searchEndpoint&&algoliasearch){algoliaSearchClient||(algoliaSearchClient=algoliasearch("1R78TOVXIF","820e7a4698c4a73b53d7054a38c80b3f"));const n=algoliaSearchClient.initIndex(SEARCH_INDEX),{hits:r}=await n.search(i);t.forEach(t=>{const{type:n}=t.dataset;a.push({html:e[`wrapSearch${n}ResultSnippet`].call(this,r),type:n})})}else if(axios){const n=await axios.get("/graphql",{params:{query:"\n    query searchContent($searchKey: String!) {\n      searchPostsByKey(key: $searchKey) {\n        title\n        url\n        date\n        rawDate\n        snippets\n      }\n    }\n              ",variables:{searchKey:i}}});if(Array.isArray(n.data.errors)&&n.data.errors.length>0)return void alert(n.data.errors[0].message);const{data:{data:{...r}}}=n;t.forEach(t=>{const{type:n}=t.dataset;a.push({html:e[`wrapSearch${n}ResultSnippet`].call(this,r[`search${n}sByKey`]),type:n})})}0===a.filter(e=>e.html).length?(t.forEach(e=>{e.innerHTML=""}),n.style.display="block"):(n.style.display="none",t.forEach(e=>{const{type:t}=e.dataset,{html:n}=a.filter(e=>e.type===t)[0];n&&(e.innerHTML="",e.insertAdjacentHTML("afterbegin",n))}))}catch(r){console.error(r.message)}finally{s.disabled=!1,s.innerText="搜索"}}})});