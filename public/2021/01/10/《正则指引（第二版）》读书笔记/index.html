<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>《正则指引（第二版）》读书笔记 | 曜彤.手记</title><meta name="baidu-site-verification" content="codeva-P9jyH0b1lv"><meta name="description" content="旧书清理系列。正好赶上新出不久的第二版，年前暂时不读“板砖”了，找点薄的速读一下。"><meta name="generator" content="曜彤.手记"><meta name="keywords" content="博客, C++, C, Rust, Web, Java, IT, 编程, 开发, Android, Python, MySQL, 科技, 黑客, 技术, Javascript, 云, 大数据, 计算, 机器学习, AI, 人工智能, 创业, 产品, 公司, WebAssembly, Wasm"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.jpg"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-touch-icon-60x60.jpg"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.jpg"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.jpg"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.jpg"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.jpg"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.jpg"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.jpg"><link rel="apple-touch-icon" sizes="196x196" href="/images/apple-touch-icon-196x196.jpg"><link rel="apple-touch-icon" sizes="310x310" href="/images/apple-touch-icon-310x310.jpg"><link href="/images/splash/iphone5_splash.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/iphone6_splash.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/iphoneplus_splash.png" media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image"><link href="/images/splash/iphonex_splash.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image"><link href="/images/splash/iphonexr_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/iphonexsmax_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image"><link href="/images/splash/ipad_splash.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/ipadpro1_splash.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/ipadpro3_splash.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/ipadpro2_splash.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="128x128" href="/images/favicon-128.png"><link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-196x196.png"><meta name="msapplication-TileColor" content="#FFFFFF"><meta name="msapplication-TileImage" content="mstile-144x144.png"><meta name="msapplication-square70x70logo" content="mstile-70x70.png"><meta name="msapplication-square150x150logo" content="mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="mstile-310x150.png"><meta name="msapplication-square310x310logo" content="mstile-310x310.png"><meta name="msapplication-square310x310logo" content="mstile-310x310.png"><link rel="manifest" href="/manifest.webmanifest"><link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="/atom.xml"><link rel="stylesheet" href="/css/prism-okaidia.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body itemscope itemtype="https://schema.org/WebPage"><div class="canvas-containter"><span>X</span></div><header itemscope itemtype="https://schema.org/WPHeader"><div class="logo"></div><h1 class="title"><a href="/" alt="曜彤.手记" title="曜彤.手记" itemprop="headline">曜彤.手记</a><a title="Atom 0.3" target="__blank" href="/atom.xml" class="rss"><img src="/images/rss.png"></a></h1><p itemprop="description" class="description">随记，关于互联网技术、产品与创业</p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name" class="menu-item"><a href="/ " alt="首页" title="首页" itemprop="url">首页</a></li><li itemprop="name" class="menu-item"><a href="/articles" alt="文章" title="文章" itemprop="url">文章</a></li><li itemprop="name" class="menu-item"><a href="/readings" alt="阅读" title="阅读" itemprop="url">阅读</a></li><li itemprop="name" class="menu-item"><a href="/cards" alt="快记" title="快记" itemprop="url">快记</a></li><li itemprop="name" class="menu-item"><a href="/tags" alt="标签" title="标签" itemprop="url">标签</a></li><li itemprop="name" class="menu-item"><a href="/about" alt="关于" title="关于" itemprop="url">关于</a></li></ul></nav><div class="dynamic-slot"></div><div class="toc-body"><div class="bookmark"></div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-1-%E7%AB%A0-%E5%AD%97%E7%AC%A6%E7%BB%84"><span class="toc-text">第 1 章 - 字符组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-2-%E7%AB%A0-%E9%87%8F%E8%AF%8D"><span class="toc-text">第 2 章 - 量词</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-3-%E7%AB%A0-%E6%8B%AC%E5%8F%B7"><span class="toc-text">第 3 章 - 括号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-4-%E7%AB%A0-%E6%96%AD%E8%A8%80"><span class="toc-text">第 4 章 - 断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-5-%E7%AB%A0-%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%BC%8F"><span class="toc-text">第 5 章 - 匹配模式</span></a></li></ol></div><div class="space"></div></header><main itemscope itemtype="https://schema.org/Blog"><script src="https://shadow.elemecdn.com/npm/zoomage.js@latest/dist/zoomage.min.js" type="text/javascript"></script><script src="https://shadow.elemecdn.com/npm/axios@0.18.0/dist/axios.min.js" type="text/javascript"></script><script src="/scripts/post.js" type="text/javascript"></script><div class="touch-top"><span></span></div><article post-id="《正则指引（第二版）》读书笔记" class="full article-post"><h1 itemprop="headline" class="align-center">《正则指引（第二版）》读书笔记</h1><div class="content"><div class="article-meta"><span class="post-meta"><br>Created on<time itemprop="dateCreated" datetime="2021-01-10T09:24:06.000Z"> 2021 / 01 / 10, 17:24:06</time></span><span class="page-tag-anchor"><a href="/tags/计算机" itemprop="url">#计算机</a>&nbsp;&nbsp;</span></div><p>旧书清理系列。正好赶上新出不久的第二版，年前暂时不读“板砖”了，找点薄的速读一下。</p>
<p>（仅记录 <strong>PCRE</strong> 相关的正则用法，Posix 等其他用法略。不重要的章节略）</p>
<h3 id="第-1-章-字符组"><a href="#第-1-章-字符组" class="headerlink" title="第 1 章 - 字符组"></a>第 1 章 - 字符组</h3><ol>
<li><span class="pn">Page 2</span><strong>字符组</strong>：</li>
</ol>
<ul>
<li>表示“在同一个位置可能出现的各种字符”（<strong>只能匹配一个字符</strong>）。</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 只要出现字符组中的任意字符即匹配成功；</span>
<span class="token regex">/[12345]/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'F1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span class="token regex">/[1-5]/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'F1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 范围表示法；</span>
<span class="token regex">/[0-9a-zA-Z]/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token regex">/[\x00-\x7f]/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 匹配全 ASCII 码表；</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>“范围表示法”的字符范围是<strong>根据 “-” 符号两端字符的 ASCII 码值</strong>来确定的（小-大）；</li>
<li>可以使用 “\x” 的方式来匹配不可打印或不好打印字符（如“非本地文字”）；</li>
<li>转义“<strong>元字符</strong>”：（当正则是以“字符串”形式给出时，“\” 需要用 “\” 代替。否则会被当做非法的转义字符）。</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token regex">/[0\-9]/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'0-9'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><strong>完全匹配</strong>：整个字符串需要完全与正则匹配。</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 正则只能匹配一个字符，而字符串多于一个字符；</span>
<span class="token regex">/^[12\]345]$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'2345'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// false.</span>
<span class="token comment" spellcheck="true">// 整个字符串的完全匹配；</span>
<span class="token regex">/^\[2345]$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'[2345]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>“<strong>排除型</strong>”字符组：（必须匹配一个字符）。</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token regex">/^[^0-9][0-9]$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'A2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><strong>字符组简记法</strong>（ASCII 匹配规则）：<ul>
<li><em><strong>\d</strong></em>：等价于 <i>[0-9]</i>（数字）；</li>
<li><em><strong>\w</strong></em>：等价于 <i>[0-9a-zA-Z_]</i>（单词字符）；</li>
<li><em><strong>\s</strong></em>：等价于 <i>[ \t\r\n\v\f]</i>（空白字符）；</li>
<li><em><strong>\D</strong></em>：与 <em>\d</em> 互补；</li>
<li><em><strong>\W</strong></em>：与 <em>\w</em> 互补；</li>
<li><em><strong>\S</strong></em>：与 <em>\s</em> 互补。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 匹配十六进制字符；</span>
<span class="token regex">/^[\da-zA-Z]$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'F'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span class="token regex">/^[^\d]$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span class="token regex">/^\d$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span class="token comment" spellcheck="true">// 匹配所有字符；</span>
<span class="token regex">/^[\s\S]*$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Hello, world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>转义</strong>：对于一般形式的字符组 <code>[a-z]</code>，<strong>转义时仅需要给第一个字符添加反斜线即可</strong>，即 “\[a-z]”。</li>
</ul>
<h3 id="第-2-章-量词"><a href="#第-2-章-量词" class="headerlink" title="第 2 章 - 量词"></a>第 2 章 - 量词</h3><ol start="2">
<li><span class="pn">Page 17</span><strong>量词</strong>：</li>
</ol>
<ul>
<li>可用于指定“<strong>匹配的次数</strong>”；</li>
<li>通常，可匹配次数的上限为 65536 次（实现相关，一般认为不存在上限）。</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token regex">/^[\d]{6,8}$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span class="token regex">/^[\d]{4,}$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span class="token regex">/^[\d]{4}$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// false.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>简记量词</strong>：<ul>
<li><b>+</b>：等价于 <i>{1,}</i>；</li>
<li><b>*</b>：等价于 <i>{0,}</i>；</li>
<li><b>?</b>：等价于 <i>{0,1}</i>。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token regex">/^&lt;[^>]+>$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'&lt;div>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span class="token regex">/^&lt;[^/][^>]*[^/]>$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'&lt;div>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span class="token regex">/^&lt;\/[^>]*>$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'&lt;/div>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span class="token regex">/^&lt;[^>\/]*\/>$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'&lt;div/>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>任意字符匹配</strong>：“<b>*</b>”；<ul>
<li>无法匹配换行符（\n）；</li>
</ul>
</li>
<li>上述量词默认均为“<strong>匹配优先量词</strong>（贪婪匹配）”，即：<strong>会匹配符合要求的最长子串</strong>。在匹配时会先贪婪地匹配所有符合要求的字符，直到最后再通过“<strong>回溯</strong>”满足正则其余部分的要求。</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token regex">/\".*\"/</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`"quoted string" and another"`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment" spellcheck="true">// "quoted string" and another".</span>
<span class="token regex">/\"[^\"]*\"/</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`"quoted string" and another"`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// "quoted string".</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>忽略优先量词</strong>（懒惰量词，效率相对较低）：“<b>*?</b>”，选择能保证后序正则优先匹配的当前最小匹配。在匹配时会先选择“不匹配”的状态，再尝试表达式中之后的元素，如果尝试失败，再回溯，选择之前保存的“匹配”状态。</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token operator">...</span><span class="token template-string"><span class="token string">`&lt;div>A&lt;/div>&lt;div>B&lt;/div>`</span></span><span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span><span class="token regex">/&lt;div>[\S\s]*?&lt;\/div>/g</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">// (2) [Array(1), Array(1)].</span>
<span class="token regex">/\/\/.*/</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`// comment here.`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token operator">/</span><span class="token operator">/</span> 匹配“单行注释”；
<span class="token regex">/\*[\S\s]*?\*\//</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/* comment here */`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 匹配“多行注释”（不能嵌套，所以优先选择第一个）；</span>
<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">...</span><span class="token template-string"><span class="token string">`&lt;script>let x = 1;&lt;/script>`</span></span><span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span><span class="token regex">/&lt;script[\s>][\S\s]*?&lt;\/script>/g</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 匹配特定 HTML 标签；</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="1.png"></p>
<ul>
<li><strong>转义</strong>：对于一般形式的量词 <code>&#123;m,n&#125;</code>，其含有的特殊字符不止一个，但<strong>转义时仅需要给第一个字符添加反斜线即可</strong>。其他形式则需要转义每个字符。</li>
</ul>
<h3 id="第-3-章-括号"><a href="#第-3-章-括号" class="headerlink" title="第 3 章 - 括号"></a>第 3 章 - 括号</h3><ol start="3">
<li><span class="pn">Page 33</span><strong>括号</strong>：</li>
</ol>
<ul>
<li>默认情况下，量词只能应用在“字符(组)”上。<strong>使用括号，可以将量词应用在一个整体的表达式规则上</strong>。这种功能被称为“分组”；</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token regex">/(^abc(de)*$)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`abcdedede`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><strong>多选结构</strong>：“<b>(…|…)</b>”。<ul>
<li>可以没有最外层的“括号”，但可能由于优先级产生意外的效果（比如 <code>/^ab|cd$/</code> 与 <code>/^(ab|cd)$/</code> 的解析规则并不相同）；</li>
<li>没有类似“字符组”的“排除”方式；</li>
<li>分支的排序是有讲究的，<strong>大多数实现会选择最左侧的分支</strong>；</li>
<li>尽量避免多选分支中存在重复匹配（即一段文本可由多个子条件同时匹配，如 <code>/([0-9]|\w)/</code>），否则解析效率可能会受到影响；</li>
<li>整个多选结构被视为单个元素，<strong>只要其中某个子表达式能匹配，整个多选结构的匹配就能成功</strong>；</li>
<li>使用该方式匹配在某个范围内的数值字符串（分段思想）：</li>
</ul>
</li>
</ul>
<p><img src="2.png"></p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token regex">/([0-9]|[0-9]{2}|1[0-9][0-9]|2[0-4][0-9]|25[0-5])/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`125`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// true.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><strong>引用分组</strong>：提取匹配的分组内容。<ul>
<li>分组的标号是<strong>根据 “(” 出现的顺序来计数的</strong>。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// (4) ["11-22-33", "11", "22", "33", index: 0, input: "11-22-33", groups: undefined]</span>
<span class="token regex">/(\d{2})-(\d{2})-(\d{2})/g</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"11-22-33"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// (5) ["11-33-44", "11-33", "11", "33", "44", index: 0, input: "11-33-44", groups: undefined]</span>
<span class="token regex">/((\d{2})-(\d{2}))-(\d{2})/g</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"11-33-44"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>反向引用</strong>：“<strong>\num</strong>”。<ul>
<li>允许在正则表达式内<strong>引用之前捕获分组匹配的文本</strong>（非表达式）；</li>
<li>在正则替换时分组引用会产生“二义性”：$10，是理解为引用第 10 个分组的匹配内容，还是引用第 1 个分组的匹配内容，并跟随一个 “0”？<strong>JavaScript 中会在 10 号分组可引用时选择引用其内容，否则引用第 1 个分组并紧随一个 “0”</strong>（造成一定限制）；</li>
<li>命名分组：JavaScript 中的“分组” <code>(?&lt;name&gt;...)</code> 与“引用” <code>\k&lt;name&gt;</code>（… 为正则）。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// (2) ["11-11-11", "11", index: 0, input: "11-11-11", groups: undefined]</span>
<span class="token regex">/(\d{2})-\1-\1/g</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"11-11-11"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 命名分组（赋予分组名称）；</span>
<span class="token regex">/(?&lt;seq>\d{2})-\k&lt;seq>-\k&lt;seq>/g</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"11-11-11"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>非捕获分组</strong>：“<b>(?:…)</b>”（… 为正则）。<ul>
<li><strong>仅限定量词的作用范围，不捕获任何文本</strong>。某些情况下可用于提升性能；</li>
<li>此类型分组在被引用时会被略过（即无法引用）。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// (3) ["11-22-33", "22", "33", index: 0, input: "11-22-33", groups: undefined]</span>
<span class="token regex">/(?:\d{2})-(\d{2})-(\d{2})/g</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"11-22-33"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li><strong>转义</strong>：括号表达式中的元字符 “(”、“)” 以及 “|” 每一个都需要转义。</li>
<li><strong>动态提取不定长输入的特定匹配</strong>：</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex">/(?&lt;id>\d{1})/g</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 必须是全局匹配；</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'1-2-3-4-5'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> arr<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>groups<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="第-4-章-断言"><a href="#第-4-章-断言" class="headerlink" title="第 4 章 - 断言"></a>第 4 章 - 断言</h3><ol start="4">
<li><span class="pn">Page 60</span><strong>断言</strong>：正则表达式中的某些结构并不真正匹配文本，而只负责判断在某个位置左/右侧的文本是否符合要求。</li>
</ol>
<ul>
<li>常见断言种类：<strong>单词边界</strong>、<strong>行起始/结束位置</strong>、<strong>环视</strong>。</li>
</ul>
<ol start="5">
<li><span class="pn">Page 60</span>断言 - “<strong>单词边界</strong>”匹配：“<strong>\b</strong>”。</li>
</ol>
<ul>
<li>边界处要求一边是单词字符（\w），另一边不是单词字符（也可以没有任何字符）；</li>
<li>反向引用只会引用匹配到的文本，而<strong>不会保留之前的断言规则</strong>；</li>
<li>对应的也有“非单词边界”匹配 — “<strong>\B</strong>”（对应 “\b” 的补集）。</li>
</ul>
<p><img src="3.png"></p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token operator">...</span><span class="token template-string"><span class="token string">`a sentence contains a lot of words`</span></span><span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span><span class="token regex">/\b\w+\b/g</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 提取所有单词；</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="6">
<li><span class="pn">Page 62</span>断言 - “<strong>行起始/结束位置</strong>”匹配：</li>
</ol>
<ul>
<li>“<b>^</b>”：将正则匹配“定位”在字符串的<strong>开始位置</strong>（行起始位置）；</li>
<li>“<b>$</b>”：将正则匹配“定位”在字符串的<strong>结束位置</strong>（行结束位置，任何终止符之前。JavaScript 中匹配时会包含终止符）；</li>
</ul>
<p><img src="7.png"></p>
<p><img src="6.png"></p>
<ul>
<li>“<b>(?m)</b>”：设定匹配模式“<strong>多行模式</strong>”（大多数编程语言通过其他方式支持）。</li>
</ul>
<p><img src="4.png"></p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token operator">...</span><span class="token template-string"><span class="token string">`a\nsentence\ncontains\na\nlot\nof\nwords`</span></span><span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span><span class="token regex">/^\w+/gm</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 提取所有单词；</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>“<strong>\A</strong>”：（忽视多行）将正则匹配“定位”在<strong>整个字符串的开始位置</strong>；</li>
<li>“<strong>\Z</strong>”：（忽视多行）等价于默认非多行模式下的 “$”；</li>
<li>“<strong>\z</strong>”：（忽视多行）不管终止符，只匹配整个字符串的结束位置。</li>
</ul>
<p><img src="5.png"></p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// JavaScript 中多行正则替换的几种方式；</span>
<span class="token string">'p1\np2'</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token regex">/(\w+$)/mg</span><span class="token punctuation">,</span> <span class="token string">'&lt;p>$1&lt;/p>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token string">'p1\np2'</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token regex">/(?&lt;w>\w+$)/mg</span><span class="token punctuation">,</span> <span class="token string">'&lt;p>$&lt;w>&lt;/p>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>*一个特殊 case</strong>：</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**
 * “\s+$” 可以匹配前面的 “\t\n”：以后面的 “\n” 作为行分割符；
 * “^\s+” 可以匹配后面的 “\n”：以前一个 “\n” 作为行分隔符。
 */</span>
<span class="token string">'  begin\n between\t\n\nend  '</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token regex">/(^\s+|\s+$)/mg</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// ！不正确的结果！</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="7">
<li><span class="pn">Page 69</span><strong>环视</strong>：</li>
</ol>
<ul>
<li><strong>在它旁边的文本需要满足某种条件</strong>，但本身不匹配任何字符；</li>
<li>“环视”匹配的不是字符，而是位置。</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token regex">/&lt;(?!\/)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'&lt;div>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 匹配的左尖括号右侧不能有正斜线；</span>
<span class="token template-string"><span class="token string">`12345678`</span></span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token regex">/(?&lt;=\d)(?=(\d{2})+(?!\d))/g</span><span class="token punctuation">,</span> <span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 二位均等分割；</span>
<span class="token regex">/(?![aeiou])[a-z]/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 匹配辅音字母；</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>四种“环视”类型</strong>：<ul>
<li><strong>肯定环视要判断成功</strong>，字符串中必须有字符由环视结构中的表达式匹配；而<strong>否定环视要判断成功</strong>，却有两种情况：(1) 字符串中出现了字符，但不能由环视结构中的表达式匹配；(2) 字符串中不再有任何字符。</li>
</ul>
</li>
</ul>
<p><img src="8.png"></p>
<ul>
<li>环视的“<strong>嵌套</strong>”：</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 限制匹配字符串的固定长度；</span>
<span class="token regex">/^(?=\d{0,3}(?!\d))/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'111123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>环视的“<strong>并列</strong>”：</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 对同一个位置附加多个条件；</span>
<span class="token regex">/^(?=\d+)(?!999)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'111123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token regex">/^(?=\d+(?&lt;!999)$)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'111999'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 字符串不能以 “999” 结尾；</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>“<strong>多选</strong>结构”中的环视：</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token regex">/((?!\d)|(?=\d\D))/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'ab'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 找到一个位置，其后面要么不是数字，要么是一个数字和非数字字符；</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="第-5-章-匹配模式"><a href="#第-5-章-匹配模式" class="headerlink" title="第 5 章 - 匹配模式"></a>第 5 章 - 匹配模式</h3><ol start="8">
<li><span class="pn">Page 83</span><strong>匹配模式</strong>：</li>
</ol>
<ul>
<li>两种指定方式：<ul>
<li><strong>模式修饰符</strong>形式 “(?modifier)” 嵌在正则开头（仅 JavaScript 不支持）；</li>
<li><strong>预定义常量</strong>作为特殊参数传入正则函数（通常为先生成 Pattern 对象，然后再调用对应匹配方法）。</li>
</ul>
</li>
<li><em><strong>不区分大小写模式</strong></em>（“<strong>i</strong>”）：此模式下匹配时不区分字符大小写；</li>
<li><em><strong>单行模式</strong></em>（“<strong>s</strong>”）：此模式下 “.” 可以匹配包括换行符在内的任何字符；</li>
<li><em><strong>多行模式</strong></em>（“<strong>m</strong>”）：此模式下 “^” 与 “$” 可以匹配字符串内部某一行文本的起始位置和结束位置；</li>
<li><em><strong>注释模式</strong></em>（“<strong>x</strong>”）：为正则添加注释 “<b>(?#comment)</b>”。</li>
<li>模式可以通过括号来限定其作用域；</li>
<li>结束模式的生效范围：“<b>(?-modifier)</b>”</li>
</ul>
<pre class="line-numbers language-pcre"><code class="language-pcre">/(?i)(foo|zee)(?-i)BAR/
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<br><div class="article-bottom-meta"><span class="post-meta">Last built on<time itemprop="dateModified" datetime="2021-01-10T09:24:06.000Z"> 2025 / 03 / 31, 15:59:32</time></span></div></div></article><br><span class="next-post"><a href="/2021/01/19/《计算机网络（第七版）》读书笔记（第-1-2-章）/" itemprop="url">下一篇 ⇒</a></span><span class="prev-post"><a href="/2021/01/03/《计算的本质：深入剖析程序和计算机》读书笔记（第-5-9-章）/" itemprop="url">⇐ 上一篇</a></span><br><section id="comments"><h4>评论 | Comments</h4><br><div class="comment-container"><div class="loading-mask">Loading ...</div><script src="https://utteranc.es/client.js" repo="Becavalier/utterances-comments" issue-term="title" label="[Comment]" theme="github-light" crossorigin="anonymous" async></script></div></section><br><br></main><script src="/scripts/index.js" type="text/javascript"></script></body></html>