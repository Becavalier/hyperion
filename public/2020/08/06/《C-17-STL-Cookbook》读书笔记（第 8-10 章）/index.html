<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>《C++17 STL Cookbook》读书笔记（第 8-10 章） | 曜彤.手记</title><meta name="description" content="还是继续接上篇。"><meta name="generator" content="曜彤.手记"><meta name="author" content="于航(曜彤)"><meta name="keywords" content="博客, C++, C, Rust, Web, Java, IT, 编程, 开发, Android, Python, MySQL, 科技, 黑客, 技术, Javascript, 云, 大数据, 计算, 机器学习, AI, 人工智能, 创业, 产品, 公司, WebAssembly, Wasm"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.jpg"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-touch-icon-60x60.jpg"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.jpg"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.jpg"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.jpg"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.jpg"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.jpg"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.jpg"><link rel="apple-touch-icon" sizes="196x196" href="/images/apple-touch-icon-196x196.jpg"><link rel="apple-touch-icon" sizes="310x310" href="/images/apple-touch-icon-310x310.jpg"><link href="/images/splash/iphone5_splash.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/iphone6_splash.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/iphoneplus_splash.png" media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image"><link href="/images/splash/iphonex_splash.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image"><link href="/images/splash/iphonexr_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/iphonexsmax_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image"><link href="/images/splash/ipad_splash.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/ipadpro1_splash.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/ipadpro3_splash.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/ipadpro2_splash.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="128x128" href="/images/favicon-128.png"><link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-196x196.png"><meta name="msapplication-TileColor" content="#FFFFFF"><meta name="msapplication-TileImage" content="mstile-144x144.png"><meta name="msapplication-square70x70logo" content="mstile-70x70.png"><meta name="msapplication-square150x150logo" content="mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="mstile-310x150.png"><meta name="msapplication-square310x310logo" content="mstile-310x310.png"><meta name="msapplication-square310x310logo" content="mstile-310x310.png"><link rel="manifest" href="/manifest.webmanifest"><link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="/atom.xml"><link rel="stylesheet" href="/css/prism-okaidia.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body itemscope itemtype="https://schema.org/WebPage"><div class="canvas-containter"><span>X</span></div><header itemscope itemtype="https://schema.org/WPHeader"><div class="logo"></div><h1 class="title"><a href="/" alt="曜彤.手记" title="曜彤.手记" itemprop="headline">曜彤.手记</a><a title="Atom 0.3" target="__blank" href="/atom.xml" class="rss"><img src="/images/rss.png"></a></h1><p itemprop="description" class="description">随记，关于互联网技术、产品与创业</p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name" class="menu-item"><a href="/ " alt="首页" title="首页" itemprop="url">首页</a></li><li itemprop="name" class="menu-item"><a href="/articles" alt="文章" title="文章" itemprop="url">文章</a></li><li itemprop="name" class="menu-item"><a href="/notes" alt="记录" title="记录" itemprop="url">记录</a></li><li itemprop="name" class="menu-item"><a href="/readings" alt="阅读" title="阅读" itemprop="url">阅读</a></li><li itemprop="name" class="menu-item"><a href="/tags" alt="标签" title="标签" itemprop="url">标签</a></li><li itemprop="name" class="menu-item"><a href="/author" alt="关于" title="关于" itemprop="url">关于</a></li></ul></nav><p class="meta-icp"><a target="_blank" href="https://beian.miit.gov.cn/"><span>吉 ICP 备10004938-2号</span></a></p><div class="space"></div></header><main itemscope itemtype="https://schema.org/Blog"><script src="https://shadow.elemecdn.com/npm/zoomage.js@latest/dist/zoomage.min.js" type="text/javascript"></script><script src="https://shadow.elemecdn.com/npm/axios@0.18.0/dist/axios.min.js" type="text/javascript"></script><script src="/scripts/post.js" type="text/javascript"></script><div class="touch-top"><span></span></div><article post-id="bd357b4b2628aba729aab94a84ecdb0e" class="full"><h1 itemprop="headline" class="post-heading">《C++17 STL Cookbook》读书笔记（第 8-10 章）</h1><div class="article-meta"><span class="post-meta"><br>Created on<time itemprop="dateCreated" datetime="2020-08-06T05:24:05.000Z"> 2020 / 08 / 06, 13:24:05</time></span><span class="page-tag-anchor"><a href="/tags/C++" itemprop="url">#C++</a>&nbsp;&nbsp;</span></div><br><p>还是继续接上篇。</p>
<h3 id="Chapter-8-Utility-Classes"><a href="#Chapter-8-Utility-Classes" class="headerlink" title="Chapter 8: Utility Classes"></a>Chapter 8: Utility Classes</h3><h5>使用 std::ratio 转换不同的时间单位</h5>

<ul>
<li>几种不同类型的时钟对象：<ul>
<li><strong><em>std::chrono::system_clock</em></strong>：表示系统级别的实时挂钟。想要获取本地时间的话，这是个正确的选择；</li>
<li><strong><em>std::chrono::steady_clock</em></strong>：表示单调型的时间。这个时间是不可能倒退的，而时间倒退可能会在其他时钟上发生，比如：其最小精度不同，或是在冬令时和夏令时交替时发生；</li>
<li><strong><em>std::chrono::high_resolution_clock</em></strong>：STL 中可统计<strong>最细粒度</strong>时钟周期的时钟；</li>
</ul>
</li>
<li>std::chrono::duration 结构：<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span>
  <span class="token keyword">class</span> <span class="token class-name">Rep</span><span class="token punctuation">,</span> 
  <span class="token keyword">class</span> <span class="token class-name">Period</span> <span class="token operator">=</span> std<span class="token operator">::</span>ratio<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">></span> 
<span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">duration</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Rep 为一个数值类型，用来保存某时间点的值（默认为 <code>long long int</code>）。</li>
<li>Period 为比例参数，默认情况下为 std::ratio&lt;1&gt;，即 1。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// "chrono::duration" represents a time interval.</span>
<span class="token keyword">using</span> seconds <span class="token operator">=</span> chrono<span class="token operator">::</span>duration<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token keyword">using</span> milliseconds <span class="token operator">=</span> chrono<span class="token operator">::</span>duration<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> ratio_multiply<span class="token operator">&lt;</span>seconds<span class="token operator">::</span>period<span class="token punctuation">,</span> milli<span class="token operator">>></span><span class="token punctuation">;</span>
<span class="token keyword">using</span> microseconds <span class="token operator">=</span> chrono<span class="token operator">::</span>duration<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> ratio_multiply<span class="token operator">&lt;</span>seconds<span class="token operator">::</span>period<span class="token punctuation">,</span> micro<span class="token operator">>></span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// get user input.</span>
<span class="token keyword">static</span> pair<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> seconds<span class="token operator">></span> <span class="token function">getInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  string s<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// save the current time point.</span>
  <span class="token keyword">const</span> <span class="token keyword">auto</span> <span class="token function">tic</span> <span class="token punctuation">(</span>chrono<span class="token operator">::</span>steady_clock<span class="token operator">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>cin <span class="token operator">>></span> s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token keyword">auto</span> <span class="token function">toc</span> <span class="token punctuation">(</span>chrono<span class="token operator">::</span>steady_clock<span class="token operator">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>s<span class="token punctuation">,</span> toc <span class="token operator">-</span> tic<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Please type the word \"C++17\" as fast as you can.\n> "</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> <span class="token punctuation">[</span>userInput<span class="token punctuation">,</span> diff<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userInput <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userInput <span class="token operator">==</span> <span class="token string">"C++17"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Bravo. You did it in:\n"</span>
          <span class="token operator">&lt;&lt;</span> fixed <span class="token operator">&lt;&lt;</span> <span class="token function">setprecision</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
          <span class="token operator">&lt;&lt;</span> <span class="token function">setw</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> diff<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token operator">&lt;&lt;</span> <span class="token string">" seconds.\n"</span>
          <span class="token operator">&lt;&lt;</span> <span class="token function">setw</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token function">milliseconds</span><span class="token punctuation">(</span>diff<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token operator">&lt;&lt;</span> <span class="token string">" milliseconds.\n"</span>
          <span class="token operator">&lt;&lt;</span> <span class="token function">setw</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token function">microseconds</span><span class="token punctuation">(</span>diff<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token operator">&lt;&lt;</span> <span class="token string">" microseconds.\n"</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Sorry, your input does not match. You may try again.\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>std::ratio_multiply 用于<strong>将两个 std::ratio 相乘</strong>（如：2/3 * 1/6 = 1/9）。<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">typedef</span> ratio<span class="token operator">&lt;</span><span class="token number">1LL</span><span class="token punctuation">,</span> <span class="token number">1000000LL</span><span class="token operator">></span> micro<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> ratio<span class="token operator">&lt;</span><span class="token number">1LL</span><span class="token punctuation">,</span> <span class="token number">1000LL</span><span class="token operator">></span> milli<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>std::chrono::duration::period：std::__1::ratio&lt;1L&gt;。</li>
</ul>
</li>
</ul>
<h5>使用 std::chrono 转换绝对时间与相对时间</h5>

<ul>
<li>常用的实际偏移字面量值（std::chrono::duration）：<ul>
<li>hours (<strong>h</strong>)；</li>
<li>minutes (<strong>min</strong>)；</li>
<li>seconds (<strong>s</strong>)；</li>
<li>milliseconds (<strong>ms</strong>)；</li>
<li>microseconds (<strong>us</strong>)；</li>
<li>nanoseconds (<strong>ns</strong>)；</li>
</ul>
</li>
<li>std::time：<strong>表示时间的算数类型，通常为一个整型</strong>。该值包含自 1970/01/01 UTC 的 00:00 开始的秒数。</li>
</ul>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> chrono_literals<span class="token punctuation">;</span>
ostream<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword">const</span> chrono<span class="token operator">::</span>time_point<span class="token operator">&lt;</span>chrono<span class="token operator">::</span>system_clock<span class="token operator">></span><span class="token operator">&amp;</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// "chrono::time_point&lt;chrono::system_clock>" -> "std::time_t".</span>
  <span class="token keyword">const</span> <span class="token keyword">auto</span> <span class="token function">tt</span> <span class="token punctuation">(</span>chrono<span class="token operator">::</span>system_clock<span class="token operator">::</span><span class="token function">to_time_t</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// convert to local time.</span>
  <span class="token keyword">const</span> <span class="token keyword">auto</span> <span class="token function">loct</span> <span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">localtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// "%c" stands for standard date formatting string.</span>
  <span class="token keyword">return</span> os <span class="token operator">&lt;&lt;</span> <span class="token function">put_time</span><span class="token punctuation">(</span>loct<span class="token punctuation">,</span> <span class="token string">"%c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// add time offset.</span>
<span class="token keyword">using</span> days <span class="token operator">=</span> chrono<span class="token operator">::</span>duration<span class="token operator">&lt;</span>
  chrono<span class="token operator">::</span>hours<span class="token operator">::</span>rep<span class="token punctuation">,</span>
  ratio_multiply<span class="token operator">&lt;</span>chrono<span class="token operator">::</span>hours<span class="token operator">::</span>period<span class="token punctuation">,</span> ratio<span class="token operator">&lt;</span><span class="token number">24</span><span class="token operator">>></span><span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">constexpr</span> days <span class="token keyword">operator</span> <span class="token string">""</span><span class="token function">_days</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> days<span class="token punctuation">{</span>d<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">auto</span> <span class="token function">now</span> <span class="token punctuation">(</span>chrono<span class="token operator">::</span>system_clock<span class="token operator">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"The current date and time is "</span> <span class="token operator">&lt;&lt;</span> now <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  chrono<span class="token operator">::</span>hours chrono_12h <span class="token punctuation">{</span><span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"In 12 hours, it will be "</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>now <span class="token operator">+</span> chrono_12h<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"12 hours and 15 minutes ago, it was "</span>
       <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> 12h <span class="token operator">-</span> 15min<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span>
       <span class="token operator">&lt;&lt;</span> <span class="token string">"1 week ago, it was "</span>
       <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> 7_days<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5>使用 std::optional 安全地标识失败</h5>

<ul>
<li>std::optional::value_or：可以设置 std::optional 的<strong>默认值</strong>；</li>
<li>当访问没有值的 std::optional 时会抛出 <strong>std::logic_error</strong> 异常；</li>
</ul>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">using</span>  oint <span class="token operator">=</span> std<span class="token operator">::</span>optional<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">;</span>
oint <span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>cin <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span>i<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
oint <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span>oint x<span class="token punctuation">,</span> oint y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// if optional x and y have value?</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>x <span class="token operator">||</span> <span class="token operator">!</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">*</span>x <span class="token operator">+</span> <span class="token operator">*</span>y<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
oint <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span>oint x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">*</span>x <span class="token operator">+</span> y<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Please enter 2 integers.\n> "</span><span class="token punctuation">;</span>
  <span class="token keyword">auto</span> x <span class="token punctuation">{</span> <span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">auto</span> y <span class="token punctuation">{</span> <span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">auto</span> <span class="token function">sum</span><span class="token punctuation">(</span>x <span class="token operator">+</span> y <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>sum <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"sorry, the input was something else than 2 numbers.\n"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5>std::tuple 的打包与解包</h5>

<ul>
<li><strong>std::apply</strong>：用一个 std::tuple 作为参数来调用 Callable 对象 f（模板参数可自动推导）。</li>
</ul>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">using</span> std<span class="token operator">::</span><span class="token keyword">operator</span><span class="token string">""</span>s<span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printStudent</span><span class="token punctuation">(</span>size_t id<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">,</span> <span class="token keyword">double</span> gpa<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Student "</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span><span class="token function">quoted</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
       <span class="token operator">&lt;&lt;</span> <span class="token string">", ID: "</span> <span class="token operator">&lt;&lt;</span> id
       <span class="token operator">&lt;&lt;</span> <span class="token string">", GPA: "</span> <span class="token operator">&lt;&lt;</span> gpa <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">using</span> student <span class="token operator">=</span> std<span class="token operator">::</span>tuple<span class="token operator">&lt;</span>size_t<span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">></span><span class="token punctuation">;</span>
  student john <span class="token punctuation">{</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">"John Doe"</span>s<span class="token punctuation">,</span> <span class="token number">3.7</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> gpa<span class="token punctuation">]</span> <span class="token operator">=</span> john<span class="token punctuation">;</span>
  <span class="token function">printStudent</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> gpa<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"-----\n"</span><span class="token punctuation">;</span>
  <span class="token keyword">auto</span> argumentsForLater <span class="token operator">=</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span><span class="token function">make_tuple</span><span class="token punctuation">(</span><span class="token number">234</span><span class="token punctuation">,</span> <span class="token string">"John Doe"</span>s<span class="token punctuation">,</span> <span class="token number">3.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    std<span class="token operator">::</span><span class="token function">make_tuple</span><span class="token punctuation">(</span><span class="token number">345</span><span class="token punctuation">,</span> <span class="token string">"Billy Foo"</span>s<span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    std<span class="token operator">::</span><span class="token function">make_tuple</span><span class="token punctuation">(</span><span class="token number">456</span><span class="token punctuation">,</span> <span class="token string">"Cathy Bar"</span>s<span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> gpa<span class="token punctuation">]</span> <span class="token operator">:</span> argumentsForLater<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printStudent</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> gpa<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"-----\n"</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">/**
   * // invoke the Callable object f with a tuple of arguments.
   * template &lt;class F, class Tuple>
   * constexpr decltype(auto) apply(F&amp;&amp; f, Tuple&amp;&amp; t);  
   */</span>
  std<span class="token operator">::</span><span class="token function">apply</span><span class="token punctuation">(</span>printStudent<span class="token punctuation">,</span> john<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"-----\n"</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5>使用 std::tuple 快速构建数据结构</h5>

<ul>
<li>std::make_tuple 与 std::tuple_cat 相结合构建 zip 函数：</li>
</ul>
<p><img src="1.png" alt=""></p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>Ts<span class="token operator">></span>
<span class="token keyword">void</span> <span class="token function">printArgs</span><span class="token punctuation">(</span>std<span class="token operator">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span> v<span class="token punctuation">,</span> <span class="token keyword">const</span> Ts<span class="token operator">&amp;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>vs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  os <span class="token operator">&lt;&lt;</span> v<span class="token punctuation">;</span>
  <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> std<span class="token operator">::</span>initializer_list<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">(</span>os <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> vs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>Ts<span class="token operator">></span>
std<span class="token operator">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token operator">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>tuple<span class="token operator">&lt;</span>Ts<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">></span><span class="token operator">&amp;</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">auto</span> <span class="token function">printToOs</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>os<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span> <span class="token operator">&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>xs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printArgs</span><span class="token punctuation">(</span>os<span class="token punctuation">,</span> xs<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  os <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span><span class="token function">apply</span><span class="token punctuation">(</span>printToOs<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> os <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">></span>
std<span class="token operator">::</span>tuple<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">></span> <span class="token function">sumMinMaxAvg</span><span class="token punctuation">(</span><span class="token keyword">const</span> T <span class="token operator">&amp;</span>range<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">auto</span> <span class="token function">minMax</span> <span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">minmax_element</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">auto</span> <span class="token function">sum</span> <span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">accumulate</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>sum<span class="token punctuation">,</span> <span class="token operator">*</span>minMax<span class="token punctuation">.</span>first<span class="token punctuation">,</span> <span class="token operator">*</span>minMax<span class="token punctuation">.</span>second<span class="token punctuation">,</span> sum <span class="token operator">/</span> range<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> T1<span class="token punctuation">,</span> <span class="token keyword">typename</span> T2<span class="token operator">></span>
<span class="token keyword">static</span> <span class="token keyword">auto</span> <span class="token function">zip</span><span class="token punctuation">(</span><span class="token keyword">const</span> T1 <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> T2 <span class="token operator">&amp;</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">auto</span> <span class="token function">z</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>xs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>xs<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>ys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> std<span class="token operator">::</span><span class="token function">tuple_cat</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">make_tuple</span><span class="token punctuation">(</span>xs<span class="token punctuation">,</span> ys<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> std<span class="token operator">::</span><span class="token function">apply</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">apply</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">auto</span> <span class="token function">studentDesc</span> <span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">make_tuple</span><span class="token punctuation">(</span><span class="token string">"ID"</span><span class="token punctuation">,</span> <span class="token string">"Name"</span><span class="token punctuation">,</span> <span class="token string">"GPA"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">auto</span> <span class="token function">student</span> <span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">make_tuple</span><span class="token punctuation">(</span><span class="token number">123456</span><span class="token punctuation">,</span> <span class="token string">"John Doe"</span><span class="token punctuation">,</span> <span class="token number">3.7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> studentDesc <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span>
    <span class="token operator">&lt;&lt;</span> student <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span><span class="token function">tuple_cat</span><span class="token punctuation">(</span>studentDesc<span class="token punctuation">,</span> student<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  <span class="token keyword">auto</span> <span class="token function">zipped</span> <span class="token punctuation">(</span><span class="token function">zip</span><span class="token punctuation">(</span>studentDesc<span class="token punctuation">,</span> student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> zipped <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  <span class="token keyword">auto</span> numbers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token function">zip</span><span class="token punctuation">(</span>
    std<span class="token operator">::</span><span class="token function">make_tuple</span><span class="token punctuation">(</span><span class="token string">"Sum"</span><span class="token punctuation">,</span> <span class="token string">"Minimum"</span><span class="token punctuation">,</span> <span class="token string">"Maximum"</span><span class="token punctuation">,</span> <span class="token string">"Average"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">sumMinMaxAvg</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5>将 void* 替换为更为安全的 std::any</h5>

<ul>
<li>std::any 对象有一个 <strong>has_value()</strong> 方法，可以返回该 any 是否携带一个值；</li>
<li>std::any_cast<T>(x) 会返回 x 中 T 值的<strong>副本</strong>；如需避免拷贝，可<strong>返回引用类型</strong> std::any_cast&lt;T&amp;&gt;(x)；</li>
<li>如果 any 被转换成为一种错误的类型，则会抛出 <strong>std::bad_any_cast</strong> 异常；</li>
</ul>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">using</span> std<span class="token operator">::</span><span class="token keyword">operator</span><span class="token string">""</span>s<span class="token punctuation">;</span>
<span class="token keyword">using</span> intList <span class="token operator">=</span> std<span class="token operator">::</span>list<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">printAnything</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>any<span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>a<span class="token punctuation">.</span><span class="token function">has_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Nothing.\n"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">typeid</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"It's a string: "</span>
      <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span><span class="token function">quoted</span><span class="token punctuation">(</span>std<span class="token operator">::</span>any_cast<span class="token operator">&lt;</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span><span class="token operator">></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">typeid</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"It's an integer: "</span>
      <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>any_cast<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">typeid</span><span class="token punctuation">(</span>intList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> <span class="token operator">&amp;</span><span class="token function">l</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>any_cast<span class="token operator">&lt;</span><span class="token keyword">const</span> intList<span class="token operator">&amp;</span><span class="token operator">></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"It's a list: "</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span><span class="token function">copy</span><span class="token punctuation">(</span>
      std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">,</span> 
      std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">,</span>
      std<span class="token operator">::</span>ostream_iterator<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">{</span>std<span class="token operator">::</span>cout<span class="token punctuation">,</span> <span class="token string">", "</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Can't handle this item.\n"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">printAnything</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printAnything</span><span class="token punctuation">(</span><span class="token string">"Hello, world!"</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printAnything</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printAnything</span><span class="token punctuation">(</span>intList<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// in-place construct.</span>
  <span class="token function">printAnything</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">any</span><span class="token punctuation">(</span>std<span class="token operator">::</span>in_place_type_t<span class="token operator">&lt;</span>intList<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5>使用 std::variant 存储不同数据类型</h5>

<ul>
<li>三种成员遍历方式：<ul>
<li><strong>std::get</strong>；</li>
<li><strong>std::get_if</strong>；</li>
<li><strong>std::visit</strong>；</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token punctuation">{</span>
  std<span class="token operator">::</span>string name<span class="token punctuation">;</span>
 <span class="token keyword">public</span><span class="token operator">:</span>
  <span class="token function">Cat</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string n<span class="token punctuation">)</span> <span class="token operator">:</span> name<span class="token punctuation">{</span>n<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">void</span> <span class="token function">meow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">" says Meow!\n"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>
  std<span class="token operator">::</span>string name<span class="token punctuation">;</span>
 <span class="token keyword">public</span><span class="token operator">:</span>
  <span class="token function">Dog</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string n<span class="token punctuation">)</span> <span class="token operator">:</span> name<span class="token punctuation">{</span>n<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">void</span> <span class="token function">woof</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">" says Woof!\n"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> Animal <span class="token operator">=</span> std<span class="token operator">::</span>variant<span class="token operator">&lt;</span>Dog<span class="token punctuation">,</span> Cat<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">></span>
<span class="token keyword">bool</span> <span class="token function">is_type</span><span class="token punctuation">(</span><span class="token keyword">const</span> Animal<span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> std<span class="token operator">::</span>holds_alternative<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">struct</span> AnimalVoice <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> Dog<span class="token operator">&amp;</span> d<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> d<span class="token punctuation">.</span><span class="token function">woof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">void</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> Cat<span class="token operator">&amp;</span> c<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> c<span class="token punctuation">.</span><span class="token function">meow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token operator">::</span>list<span class="token operator">&lt;</span>Animal<span class="token operator">></span> l <span class="token punctuation">{</span>Cat<span class="token punctuation">{</span><span class="token string">"Tuba"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Dog<span class="token punctuation">{</span><span class="token string">"Balou"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Cat<span class="token punctuation">{</span><span class="token string">"Bobby"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// std::get.</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Animal<span class="token operator">&amp;</span> a <span class="token operator">:</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
      std<span class="token operator">::</span>get<span class="token operator">&lt;</span>Dog<span class="token operator">></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">woof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
      std<span class="token operator">::</span>get<span class="token operator">&lt;</span>Cat<span class="token operator">></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">meow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"-----\n"</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// std::get_if.</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Animal<span class="token operator">&amp;</span> a <span class="token operator">:</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span> <span class="token function">d</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>get_if<span class="token operator">&lt;</span>Dog<span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      d<span class="token operator">-</span><span class="token operator">></span><span class="token function">woof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span> <span class="token function">c</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>get_if<span class="token operator">&lt;</span>Cat<span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      c<span class="token operator">-</span><span class="token operator">></span><span class="token function">meow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"-----\n"</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// std::visit.</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Animal<span class="token operator">&amp;</span> a <span class="token operator">:</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span><span class="token function">visit</span><span class="token punctuation">(</span>AnimalVoice<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"-----\n"</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"There are "</span>
    <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span><span class="token function">count_if</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">,</span> is_type<span class="token operator">&lt;</span>Cat<span class="token operator">></span><span class="token punctuation">)</span>
    <span class="token operator">&lt;&lt;</span> <span class="token string">" cats and "</span>
    <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span><span class="token function">count_if</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">,</span> is_type<span class="token operator">&lt;</span>Dog<span class="token operator">></span><span class="token punctuation">)</span>
    <span class="token operator">&lt;&lt;</span> <span class="token string">" dogs in the list.\n"</span><span class="token punctuation">;</span>  
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5>自动化管理资源 — std::unique_ptr</h5>

<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">struct</span> Foo <span class="token punctuation">{</span>
  std<span class="token operator">::</span>string name<span class="token punctuation">;</span>
  <span class="token function">Foo</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string n<span class="token punctuation">)</span> <span class="token operator">:</span> name<span class="token punctuation">{</span>n<span class="token punctuation">}</span> <span class="token punctuation">{</span> std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"CTOR "</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token operator">~</span><span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"DTOR "</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">processItem</span><span class="token punctuation">(</span>std<span class="token operator">::</span>unique_ptr<span class="token operator">&lt;</span>Foo<span class="token operator">></span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Processing "</span> <span class="token operator">&lt;&lt;</span> p<span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    std<span class="token operator">::</span>unique_ptr<span class="token operator">&lt;</span>Foo<span class="token operator">></span> pA <span class="token punctuation">{</span><span class="token keyword">new</span> Foo<span class="token punctuation">{</span><span class="token string">"foo"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> <span class="token function">pB</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>Foo<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">"bar"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">processItem</span><span class="token punctuation">(</span>std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>Foo<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">"fooA"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">auto</span> <span class="token function">pA</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>Foo<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">"fooB"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// transfer ownership, old "std::unique_ptr" will be destructed.</span>
  pA <span class="token operator">=</span> std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>Foo<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">"fooC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">processItem</span><span class="token punctuation">(</span><span class="token function">move</span><span class="token punctuation">(</span>pA<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// destructed "std::unique_ptr" will be nullptr.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pA <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"End of main()\n"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5>处理共享堆内存 — std::shared_ptr</h5>

<p>（略）</p>
<h5>对共享对象使用弱指针</h5>

<p>（略）</p>
<h5>使用智能指针简化处理遗留 API</h5>

<ul>
<li><strong>为 std::shared_ptr 指定自定义 deleter 时不需要修改 std::shared_ptr 的类型</strong>（std::unique_ptr 则需要修改模板参数，因此会改变其类型）。原因是 std::shared_ptr 对象会在其<strong>控制块</strong>内动态地处理自定义 deleter 相关的逻辑；</li>
</ul>
<h5>共享同一对象的不同成员</h5>

<ul>
<li>std::shared_ptr 可以指向另外一个由 std::shared_ptr 管理的共享对象的一部分成员。但<strong>两个指针会共享同样的控制块（引用计数会增加）</strong>。因此当指向共享对象的指针析构后。指向其成员的 std::shared_ptr 仍然存活；</li>
</ul>
<p><img src="2.png" alt=""></p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">struct</span> Person <span class="token punctuation">{</span>
  std<span class="token operator">::</span>string name<span class="token punctuation">;</span>
  size_t age<span class="token punctuation">;</span>
  <span class="token function">Person</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string n<span class="token punctuation">,</span> size_t age<span class="token punctuation">)</span> <span class="token operator">:</span> name<span class="token punctuation">{</span>std<span class="token operator">::</span><span class="token function">move</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">age</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"CTOR "</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token operator">~</span><span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"DTOR "</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">></span> sharedName<span class="token punctuation">;</span>
  std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>size_t<span class="token operator">></span> sharedAge<span class="token punctuation">;</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> <span class="token function">sperson</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>make_shared<span class="token operator">&lt;</span>Person<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">"John Doe"</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sharedName <span class="token operator">=</span> std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">></span><span class="token punctuation">(</span>sperson<span class="token punctuation">,</span> <span class="token operator">&amp;</span>sperson<span class="token operator">-</span><span class="token operator">></span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sharedAge <span class="token operator">=</span> std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>size_t<span class="token operator">></span><span class="token punctuation">(</span>sperson<span class="token punctuation">,</span> <span class="token operator">&amp;</span>sperson<span class="token operator">-</span><span class="token operator">></span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"name: "</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>sharedName
    <span class="token operator">&lt;&lt;</span> <span class="token string">"\nage: "</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>sharedAge <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5>选择合适的引擎生成随机数</h5>

<p>（略）</p>
<h5>让 STL 以指定分布方式产生随机数</h5>

<p>（略）</p>
<h3 id="Chapter-9-Parallelism-and-Concurrency"><a href="#Chapter-9-Parallelism-and-Concurrency" class="headerlink" title="Chapter 9: Parallelism and Concurrency"></a>Chapter 9: Parallelism and Concurrency</h3><ul>
<li>C++17 的一个重要的扩展，是对标准函数的执行策略进行了修改。69个标准算法都能<strong>并行到不同的核上运行，甚至是向量化</strong>。</li>
<li>Clang++ <strong>暂未实现</strong> “Standardization of Parallelism TS”。</li>
</ul>
<p>（略）</p>
<h3 id="Chapter-10-Filesystem"><a href="#Chapter-10-Filesystem" class="headerlink" title="Chapter 10: Filesystem"></a>Chapter 10: Filesystem</h3><ul>
<li>部分特性仅在 <strong>macOS 10.15 及以上</strong>的系统中可用；</li>
</ul>
<p>（略）</p>
<br><div class="article-bottom-meta"><span class="post-meta">Last built on<time itemprop="dateModified" datetime="2020-08-06T05:24:05.000Z"> 2020 / 11 / 22, 20:18:05</time></span></div></article><br><a name="comments"></a><div class="article-end-saparator"><span class="line"></span><span class="text">这是文章底线，下面是评论</span><span class="line"></span></div><div class="comments-display-container"><div class="placeholder"><i class="fa fa-battery-empty">&nbsp;&nbsp;暂无评论，欢迎勾搭 ：）</i></div></div><div class="dot-decoration"></div><div class="comments-input"><textarea name="comment" placeholder="请输入评论内容 ..."></textarea><div><input type="text" placeholder="请输入昵称 ..."><button class="submit-comment">发布</button></div></div><span class="next-post"><a href="/2020/07/31/《C-17-STL-Cookbook》读书笔记（第 5-7 章）/" itemprop="url">Older Post ⇒</a></span><span class="prev-post"><a href="/2020/08/06/CRTP-与常见用例/" itemprop="url">⇐ Next Post </a></span><br><br><br><br><br></main><script src="/scripts/index.js" type="text/javascript"></script></body></html>