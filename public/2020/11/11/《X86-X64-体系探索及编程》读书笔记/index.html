<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>《X86/X64 体系探索及编程》读书笔记 | 曜彤.手记</title><meta name="description" content="又一本“砖头”，在 Intel 手册的基础之上讨论 X86/X64 处理器组成及相关编程方式的一本书。限于精力，有选择性地读一读吧。"><meta name="generator" content="曜彤.手记"><meta name="author" content="于航(曜彤)"><meta name="keywords" content="博客, C++, C, Rust, Web, Java, IT, 编程, 开发, Android, Python, MySQL, 科技, 黑客, 技术, Javascript, 云, 大数据, 计算, 机器学习, AI, 人工智能, 创业, 产品, 公司, WebAssembly, Wasm"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.jpg"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-touch-icon-60x60.jpg"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.jpg"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.jpg"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.jpg"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.jpg"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.jpg"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.jpg"><link rel="apple-touch-icon" sizes="196x196" href="/images/apple-touch-icon-196x196.jpg"><link rel="apple-touch-icon" sizes="310x310" href="/images/apple-touch-icon-310x310.jpg"><link href="/images/splash/iphone5_splash.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/iphone6_splash.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/iphoneplus_splash.png" media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image"><link href="/images/splash/iphonex_splash.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image"><link href="/images/splash/iphonexr_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/iphonexsmax_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image"><link href="/images/splash/ipad_splash.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/ipadpro1_splash.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/ipadpro3_splash.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/ipadpro2_splash.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="128x128" href="/images/favicon-128.png"><link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-196x196.png"><meta name="msapplication-TileColor" content="#FFFFFF"><meta name="msapplication-TileImage" content="mstile-144x144.png"><meta name="msapplication-square70x70logo" content="mstile-70x70.png"><meta name="msapplication-square150x150logo" content="mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="mstile-310x150.png"><meta name="msapplication-square310x310logo" content="mstile-310x310.png"><meta name="msapplication-square310x310logo" content="mstile-310x310.png"><link rel="manifest" href="/manifest.webmanifest"><link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="/atom.xml"><link rel="stylesheet" href="/css/prism-okaidia.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body itemscope itemtype="https://schema.org/WebPage"><div class="canvas-containter"><span>X</span></div><header itemscope itemtype="https://schema.org/WPHeader"><div class="logo"></div><h1 class="title"><a href="/" alt="曜彤.手记" title="曜彤.手记" itemprop="headline">曜彤.手记</a><a title="Atom 0.3" target="__blank" href="/atom.xml" class="rss"><img src="/images/rss.png"></a></h1><p itemprop="description" class="description">随记，关于互联网技术、产品与创业</p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name" class="menu-item"><a href="/ " alt="首页" title="首页" itemprop="url">首页</a></li><li itemprop="name" class="menu-item"><a href="/articles" alt="文章" title="文章" itemprop="url">文章</a></li><li itemprop="name" class="menu-item"><a href="/notes" alt="记录" title="记录" itemprop="url">记录</a></li><li itemprop="name" class="menu-item"><a href="/readings" alt="阅读" title="阅读" itemprop="url">阅读</a></li><li itemprop="name" class="menu-item"><a href="/tags" alt="标签" title="标签" itemprop="url">标签</a></li><li itemprop="name" class="menu-item"><a href="/author" alt="关于" title="关于" itemprop="url">关于</a></li></ul></nav><p class="meta-icp"><a target="_blank" href="https://beian.miit.gov.cn/"><span>吉 ICP 备10004938-2号</span></a></p><div class="space"></div></header><main itemscope itemtype="https://schema.org/Blog"><script src="https://shadow.elemecdn.com/npm/zoomage.js@latest/dist/zoomage.min.js" type="text/javascript"></script><script src="https://shadow.elemecdn.com/npm/axios@0.18.0/dist/axios.min.js" type="text/javascript"></script><script src="/scripts/post.js" type="text/javascript"></script><div class="touch-top"><span></span></div><article post-id="ad358785973c95359006bebd0bfb6019" class="full"><h1 itemprop="headline" class="post-heading">《X86/X64 体系探索及编程》读书笔记</h1><div class="article-meta"><span class="post-meta"><br>Created on<time itemprop="dateCreated" datetime="2020-11-11T00:19:13.000Z"> 2020 / 11 / 11, 08:19:13</time></span><span class="page-tag-anchor"><a href="/tags/汇编" itemprop="url">#汇编</a>&nbsp;&nbsp;<a href="/tags/X86" itemprop="url">#X86</a>&nbsp;&nbsp;<a href="/tags/X64" itemprop="url">#X64</a>&nbsp;&nbsp;</span></div><br><p>又一本“砖头”，在 Intel 手册的基础之上讨论 X86/X64 处理器组成及相关编程方式的一本书。限于精力，有选择性地读一读吧</p>
<h3 id="第一章、数与数据结构"><a href="#第一章、数与数据结构" class="headerlink" title="第一章、数与数据结构"></a>第一章、数与数据结构</h3><ol>
<li>（Page：4）X86/X64 体系使用的是“<strong>小端序</strong>”，即：MSB 对应着存储器的高地址位，LSB 对应着存储器的低地址位。而在诸如 PowerPC 等 RISC 体系下的某些架构，则可能使用“大端序”。</li>
</ol>
<pre class="line-numbers language-nasm"><code class="language-nasm"><span class="token keyword">global _main</span>
<span class="token keyword">section .data</span>
<span class="token label function">msg:</span> db <span class="token string">"It's little-endian based!"</span>, <span class="token number">10</span>
<span class="token label function">foo:</span> dd <span class="token number">0</span>

<span class="token keyword">section .text</span>
<span class="token label function">exit:</span>
  mov <span class="token register variable">rax</span>, <span class="token number">0x02000001</span>
  xor <span class="token register variable">rdi</span>, <span class="token register variable">rdi</span>
  syscall
<span class="token label function">_main:</span>  <span class="token comment" spellcheck="true">; entry here.</span>
  mov qword<span class="token operator">[</span>rel foo<span class="token operator">]</span>, <span class="token number">1</span>
  test byte<span class="token operator">[</span>rel foo<span class="token operator">]</span>, <span class="token number">1</span>
  jnz .succeed  <span class="token comment" spellcheck="true">; test whether it's little-endian.</span>
  call exit
<span class="token label function">.succeed:</span>
  mov <span class="token register variable">rax</span>, <span class="token number">0x02000004</span>
  mov <span class="token register variable">rdi</span>, <span class="token number">1</span>
  mov <span class="token register variable">rsi</span>, msg
  mov <span class="token register variable">rdx</span>, <span class="token number">13</span>
  syscall
  call exit
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>（Page：6）在 X86/X64 体系中，指令处理数据分为“基础（fundamental）”和“数值（numeric）”两大类。前者包括：byte（8 位）\ word（16 位）\ doubleword（32 位）\ quadword（64 位），它们代表<strong>指令能一次性处理的数据宽度</strong>。后者主要使用在<strong>运算类指令</strong>上，包括：</li>
</ol>
<ul>
<li><em><strong>整数</strong></em>：包括 unsigned 与 signed 类型；</li>
<li><em><strong>浮点数</strong></em>：包括单精度浮点（1/8/23）、双精度浮点（1/11/52）与扩展双精度浮点（1/15/64）；</li>
<li><em><strong>BCD</strong></em>（binary-code decmial integer）：包括 non-packed BCD 码与 packed BCD 码；</li>
<li><em><strong>SIMD</strong></em>：单指令多数据流；</li>
</ul>
<ol start="3">
<li>（Page：7）不存在 unsigned 浮点数（IEEE-754 有小数位）。</li>
<li>（Page：7）<strong>在 X86 中，对整数的加减法运算（乘除会在具体指令上进行区分）不会识别 signed 与 unsigned 的区别</strong>。而是会同时根据两种情况下的运算结果来修改 eflags 的标志位（比如 OF 与 SF），具体如何解释则由上层程序负责。而 RISC 体系普遍会在<strong>指令层上进行假定运算</strong>（比如 add 与 addu，一个针对 signed，另一个针对 unsigned）。</li>
<li>（Page：9）在单精度与双精度浮点数中，“尾数”部分有一个<strong>隐式</strong>的整数位，该位的值为固定的 “1”。在扩展双精度浮点数中，“尾数”有 64 位，“指数”有 15 位；且其中<strong>隐式的整数位是显式的</strong>，在 “normal（规格化）” 数中，这个位必须为 1，否则属于 “denormal（非规格化）” 数。</li>
</ol>
<ul>
<li>在规格化浮点数中，浮点数的尾数不应当包含前导 0。如果全部用十进制表示，对于类似 “0.0123” 的浮点数，规格化的表示应为 “1.23e-2”。但对于某些过小的数，如 “1.23e-130”，允许的阶数位数不能满足阶数大小的需要（下溢出），这时可能就会在尾数前添加前导 0，如将其表示为 “0.000123e-126”。</li>
</ul>
<ol start="6">
<li>（Page：10）“<strong>移码</strong>（biased notation）”用来<strong>解决浮点数使用 integer 方法进行比较时出现的问题，通过使用 unsigned 值来简化指数的比较过程</strong>。</li>
</ol>
<ul>
<li><em>Biasing is done because exponents have to be signed values in order to be able to represent both tiny and huge values, <strong>but two’s complement, the usual representation for signed values, would make comparison harder</strong>.</em></li>
</ul>
<ol start="7">
<li>（Page：11）在 NASM 中使用浮点数字面量值，分别对应不同的编码方式（__float32__ / __float64__ / __float80e__）：</li>
</ol>
<pre class="line-numbers language-nasm"><code class="language-nasm"><span class="token keyword">global _main</span>
<span class="token keyword">section .text</span>
<span class="token label function">exit:</span>
  mov <span class="token register variable">rax</span>, <span class="token number">0x02000001</span>
  xor <span class="token register variable">rdi</span>, <span class="token register variable">rdi</span>
  syscall
<span class="token label function">_main:</span>  <span class="token comment" spellcheck="true">; entry here.</span>
  mov <span class="token register variable">rax</span>, __float32__(<span class="token number">0.5</span>)
  call exit
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="8">
<li>（Page：11）IEEE-754 其他实数编码格式：</li>
</ol>
<p><img src="1.png"></p>
<ul>
<li>denormal 数是一个<strong>极小的数，接近于 0</strong>。其指数部分为 0，尾数部分不为 0；</li>
<li>如果一个数超出 infinite，那就是一个 NaN 数。其分为两类：<strong>SNaN</strong>（Signaling NaN）与 <strong>QNaN</strong>（Quiet NaN）。<strong>前者表示一种比较严重的错误值，后者则通常可以接受</strong>（可能针对不同的异常）；</li>
<li>不再上述表格中的编码值均为 “<strong>unsupported 编码值</strong>”。</li>
</ul>
<ol start="9">
<li>（Page：17）IEEE-754 的四种<strong>舍入模式</strong>（用于在编码类型转换时舍入尾数部分）：</li>
</ol>
<ul>
<li><em><strong>round to nearest</strong></em>：四舍五入，且<strong>当有两个最接近的可表示的值时首选“偶数”值</strong>；</li>
<li><em><strong>round down</strong></em>：向<strong>负无穷大</strong>（向下）舍入；</li>
<li><em><strong>round up</strong></em>：向正<strong>无穷大</strong>（向上）舍入；</li>
<li><em><strong>round zero</strong></em>：向 <strong>0</strong>（截断）舍入。</li>
</ul>
<ol start="10">
<li>（Page：17）FPU（Float Point Unit）：<strong>浮点运算单元</strong>。在大多数现代通用计算机架构中，<strong>一个或多个浮点运算单元会被集成在 CPU 中</strong>。浮点数的计算也会采用独立的寄存器，比如 XMM 寄存器。</li>
<li>（Page：17）<strong>浮点数中的溢出</strong>分为两种：</li>
</ol>
<ul>
<li><strong>向上溢出</strong>：结果值超出了目标格式的最大 normal 值（即 finite 范围外）；</li>
<li><strong>向下溢出</strong>：结果值超出了目标格式的最小 normal 值（即 tiny 值或 denornal 值）；</li>
</ul>
<p><img src="2.png"></p>
<ol start="12">
<li>（Page：20）在 BCD 码中，<strong>一个十进制数的每一位，使用 8 位的二进制进行编码</strong>，如 15 的 BCD 编码为 “15H”。而在 “packed BCD” 中，每个 BCD 数字使用 4 位来表示。<strong>X86</strong> 下可以使用 <code>aaa</code> 指令来将累加器（AX）中的值转换为非压缩的 BCD 码。</li>
</ol>
<h3 id="第二章、X86-X64-编程基础"><a href="#第二章、X86-X64-编程基础" class="headerlink" title="第二章、X86/X64 编程基础"></a>第二章、X86/X64 编程基础</h3><ol start="13">
<li>（Page：24）C 语言不能直接转换为机器语言，要先由 C 编译器编译出汇编代码，然后再由汇编器生成机器指令，最终再由链接器将这些变量的地址定下来（符号重定向）。</li>
</ol>
<p><img src="3.png"></p>
<ol start="14">
<li>（Page：24）<strong>X86 机器是 CISC 体系，指令的长度不是固定的</strong>。其中最短的指令 1 字节，最长的指令 15 字节。</li>
<li>（Page：26）C 语言中的 __stdcall 与 __cdecl 调用规范会使用栈来传递参数，而使用寄存器来传递参数能获得更高的效率。</li>
</ol>
<p>（待更新）</p>
<br><div class="article-bottom-meta"><span class="post-meta">Last built on<time itemprop="dateModified" datetime="2020-11-11T00:19:13.000Z"> 2020 / 11 / 13, 11:01:09</time></span></div></article><br><a name="comments"></a><div class="article-end-saparator"><span class="line"></span><span class="text">这是文章底线，下面是评论</span><span class="line"></span></div><div class="comments-display-container"><div class="placeholder"><i class="fa fa-battery-empty">&nbsp;&nbsp;暂无评论，欢迎勾搭 ：）</i></div></div><div class="dot-decoration"></div><div class="comments-input"><textarea name="comment" placeholder="请输入评论内容 ..."></textarea><div><input type="text" placeholder="请输入昵称 ..."><button class="submit-comment">发布</button></div></div><span class="next-post"><a href="/2020/11/05/《现代-C-教程：高速上手-C-11-14-17-20》读书笔记/" itemprop="url">Older Post ⇒</a></span><span class="prev-post"><a href="/2020/11/13/《CSAPP-第三版》读书笔记（第 1-3 章）/" itemprop="url">⇐ Next Post </a></span><br><br><br><br><br></main><script src="/scripts/index.js" type="text/javascript"></script></body></html>