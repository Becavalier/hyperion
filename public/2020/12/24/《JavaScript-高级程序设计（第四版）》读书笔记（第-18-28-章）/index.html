<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>《JavaScript 高级程序设计（第四版）》读书笔记（第 18-28 章） | 曜彤.手记</title><meta name="baidu-site-verification" content="codeva-P9jyH0b1lv"><meta name="description" content="书接上回，本文为第 18-28 章的笔记。"><meta name="generator" content="曜彤.手记"><meta name="keywords" content="博客, C++, C, Rust, Web, Java, IT, 编程, 开发, Android, Python, MySQL, 科技, 黑客, 技术, Javascript, 云, 大数据, 计算, 机器学习, AI, 人工智能, 创业, 产品, 公司, WebAssembly, Wasm"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.jpg"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-touch-icon-60x60.jpg"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.jpg"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.jpg"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.jpg"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.jpg"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.jpg"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.jpg"><link rel="apple-touch-icon" sizes="196x196" href="/images/apple-touch-icon-196x196.jpg"><link rel="apple-touch-icon" sizes="310x310" href="/images/apple-touch-icon-310x310.jpg"><link href="/images/splash/iphone5_splash.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/iphone6_splash.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/iphoneplus_splash.png" media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image"><link href="/images/splash/iphonex_splash.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image"><link href="/images/splash/iphonexr_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/iphonexsmax_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image"><link href="/images/splash/ipad_splash.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/ipadpro1_splash.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/ipadpro3_splash.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link href="/images/splash/ipadpro2_splash.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="128x128" href="/images/favicon-128.png"><link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-196x196.png"><meta name="msapplication-TileColor" content="#FFFFFF"><meta name="msapplication-TileImage" content="mstile-144x144.png"><meta name="msapplication-square70x70logo" content="mstile-70x70.png"><meta name="msapplication-square150x150logo" content="mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="mstile-310x150.png"><meta name="msapplication-square310x310logo" content="mstile-310x310.png"><meta name="msapplication-square310x310logo" content="mstile-310x310.png"><link rel="manifest" href="/manifest.webmanifest"><link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="/atom.xml"><link rel="stylesheet" href="/css/prism-okaidia.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body itemscope itemtype="https://schema.org/WebPage"><div class="canvas-containter"><span>X</span></div><header itemscope itemtype="https://schema.org/WPHeader"><div class="logo"></div><h1 class="title"><a href="/" alt="曜彤.手记" title="曜彤.手记" itemprop="headline">曜彤.手记</a><a title="Atom 0.3" target="__blank" href="/atom.xml" class="rss"><img src="/images/rss.png"></a></h1><p itemprop="description" class="description">随记，关于互联网技术、产品与创业</p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name" class="menu-item"><a href="/ " alt="首页" title="首页" itemprop="url">首页</a></li><li itemprop="name" class="menu-item"><a href="/articles" alt="文章" title="文章" itemprop="url">文章</a></li><li itemprop="name" class="menu-item"><a href="/readings" alt="阅读" title="阅读" itemprop="url">阅读</a></li><li itemprop="name" class="menu-item"><a href="/cards" alt="快记" title="快记" itemprop="url">快记</a></li><li itemprop="name" class="menu-item"><a href="/tags" alt="标签" title="标签" itemprop="url">标签</a></li><li itemprop="name" class="menu-item"><a href="/about" alt="关于" title="关于" itemprop="url">关于</a></li></ul></nav><div class="dynamic-slot"></div><div class="toc-body"><div class="bookmark"></div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-18-%E7%AB%A0-%E5%8A%A8%E7%94%BB%E4%B8%8E-Canvas-%E5%9B%BE%E5%BD%A2"><span class="toc-text">第 18 章 - 动画与 Canvas 图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-19-%E7%AB%A0-%E8%A1%A8%E5%8D%95%E8%84%9A%E6%9C%AC"><span class="toc-text">第 19 章 - 表单脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-20-%E7%AB%A0-JavaScript-API"><span class="toc-text">第 20 章 - JavaScript API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-21-%E7%AB%A0-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%8E%E8%B0%83%E8%AF%95"><span class="toc-text">第 21 章 - 错误处理与调试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-22-%E7%AB%A0-%E5%A4%84%E7%90%86-XML"><span class="toc-text">第 22 章 - 处理 XML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-23-%E7%AB%A0-JSON"><span class="toc-text">第 23 章 - JSON</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-24-%E7%AB%A0-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%B8%8E%E8%BF%9C%E7%A8%8B%E8%B5%84%E6%BA%90"><span class="toc-text">第 24 章 - 网络请求与远程资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-25-%E7%AB%A0-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AD%98%E5%82%A8"><span class="toc-text">第 25 章 - 客户端存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-26-%E7%AB%A0-%E6%A8%A1%E5%9D%97"><span class="toc-text">第 26 章 - 模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-27-%E7%AB%A0-%E5%B7%A5%E4%BD%9C%E8%80%85%E7%BA%BF%E7%A8%8B"><span class="toc-text">第 27 章 - 工作者线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC-28-%E7%AB%A0-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-text">第 28 章 - 最佳实践</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%84%E5%BD%95-A-ES2018-%E5%92%8C-ES2019"><span class="toc-text">附录 A - ES2018 和 ES2019</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ECMAScript-%E4%B8%8D%E4%B8%80%E8%87%B4%E6%80%A7%E8%AE%B0%E5%BD%95%EF%BC%88%E9%83%A8%E5%88%86%E5%87%BA%E4%BA%8E%E2%80%9C%E5%85%BC%E5%AE%B9%E6%80%A7%E2%80%9D%E5%8E%9F%E5%9B%A0%EF%BC%89"><span class="toc-text">ECMAScript 不一致性记录（部分出于“兼容性”原因）</span></a></li></ol></div><div class="space"></div></header><main itemscope itemtype="https://schema.org/Blog"><script src="https://shadow.elemecdn.com/npm/zoomage.js@latest/dist/zoomage.min.js" type="text/javascript"></script><script src="https://shadow.elemecdn.com/npm/axios@0.18.0/dist/axios.min.js" type="text/javascript"></script><script src="/scripts/post.js" type="text/javascript"></script><div class="touch-top"><span></span></div><article post-id="《JavaScript 高级程序设计（第四版）》读书笔记（第 18-28 章）" class="full article-post"><h1 itemprop="headline" class="align-center">《JavaScript 高级程序设计（第四版）》读书笔记（第 18-28 章）</h1><div class="content"><div class="article-meta"><span class="post-meta"><br>Created on<time itemprop="dateCreated" datetime="2020-12-24T12:45:46.000Z"> 2020 / 12 / 24, 20:45:46</time></span><span class="page-tag-anchor"><a href="/tags/JavaScript" itemprop="url">#JavaScript</a>&nbsp;&nbsp;</span></div><p>书接上回，本文为第 18-28 章的笔记。</p>
<h3 id="第-18-章-动画与-Canvas-图形"><a href="#第-18-章-动画与-Canvas-图形" class="headerlink" title="第 18 章 - 动画与 Canvas 图形"></a>第 18 章 - 动画与 Canvas 图形</h3><ol start="72">
<li><span class="pn">Page 1317</span><code>window.requestAnimationFrame()</code>：</li>
</ol>
<ul>
<li>需要以 17ms（每秒 60 帧）为时间间隔来绘制动画，而浏览器计时器的<strong>精度不足毫秒</strong>；</li>
<li><code>setInterval()</code> 的问题：无法保证时间精度，<strong>作为第二个参数的延时只能保证何时会把代码加入到浏览器的任务队列，而不能保证添加到队列就会立即执行</strong>（如果队列前面还有其他任务，则需要等待这些任务执行完毕。并且队列的执行需要等待主线程的释放）；</li>
<li><code>window.cancelAnimationFrame()</code> 用于取消重绘任务；</li>
<li>用于节流：该函数可以<strong>保证每次重绘（60Hz）最多只执行一次回调函数</strong>；</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dadadada...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="73">
<li><span class="pn">Page 1323</span>Canvas 与 WebGL：（略）；</li>
</ol>
<h3 id="第-19-章-表单脚本"><a href="#第-19-章-表单脚本" class="headerlink" title="第 19 章 - 表单脚本"></a>第 19 章 - 表单脚本</h3><p>（略）</p>
<h3 id="第-20-章-JavaScript-API"><a href="#第-20-章-JavaScript-API" class="headerlink" title="第 20 章 - JavaScript API"></a>第 20 章 - JavaScript API</h3><ol start="74">
<li><span class="pn">Page 1452</span><strong>Atomics</strong> 与 <strong>SharedArrayBuffer</strong>：</li>
</ol>
<ul>
<li>SharedArrayBuffer <strong>可以被任意多个执行上下文（Worker）同时使用</strong>，Atomics API 可以保证其上的 JavaScript 操作是<strong>线程安全</strong>的；</li>
<li>Atomics API：<ul>
<li><strong>所有原子指令相互之间的顺序永远不会重排</strong>；</li>
<li>使用<strong>原子读（Atomics.load）或原子写（Atomics.store）</strong>可以保证所有指令（包括原子和非原子指令）都<strong>不会相对原子读/写重新排序</strong>（非原子指令只能进行“本地重排”，不会侵犯原子读/写的边界）。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint32Array</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SharedArrayBuffer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> workers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> workerScript <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
  const DEFAULT_INDEX = 0;
  self.onmessage = ({ data }) => {
    data[DEFAULT_INDEX]++;
    Atomics.store(data, DEFAULT_INDEX, 
      Atomics.load(data, DEFAULT_INDEX));
    console.log(data[DEFAULT_INDEX]);
  }
`</span></span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  workers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>
      URL<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>workerScript<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>worker <span class="token keyword">of</span> workers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>Atomics 静态方法</strong>：<ul>
<li><i>add(typedArray, index, value)</i>：加；</li>
<li><i>sub(typedArray, index, value)</i>：减；</li>
<li><i>and(typedArray, index, value)</i>：与；</li>
<li><i>or(typedArray, index, value)</i>：或；</li>
<li><i>xor(typedArray, index, value)</i>：异或。</li>
<li><i>compareExchange(typedArray, index, expectedValue, replacementValue)</i>：相等时替换，返回旧值；</li>
<li><i>exchange(typedArray, index, value)</i>：替换，返回旧值；</li>
<li><i>isLockFree(size)</i>：是一个“优化原语”，用来验证是否是能够使用原子操作的 TypedArray 标准字节长度之一；</li>
<li><i>load(typedArray, index)</i>：读；</li>
<li><i>store(typedArray, index, value)</i>：写；</li>
<li>（Int32Array）<i>notify(typedArray, index, count)</i>：提醒在<strong>等待队列</strong>中休眠的代理；</li>
<li>（Int32Array）<i>wait(typedArray, index, value[, timeout])</i>：若给定位置的值没有发生变化、仍然是给定的值时，线程将会睡眠，直到被唤醒或超时。</li>
</ul>
</li>
<li>Atomics API <strong>模仿 Linux Futex</strong>（快速用户控件排斥量）：</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int32Array</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SharedArrayBuffer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> workers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> workerScript <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
  self.onmessage = ({ data }) => {
    console.log('Wait to obtain lock...');
    Atomics.wait(data, 0, 0, 1e6);
    console.log('Obtained lock...');
    Atomics.add(data, 0, 1);
    console.log('Releasing lock...');
    Atomics.notify(data, 0, 1);
    console.log(Atomics.load(data, 0, 1));
  }
`</span></span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  workers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>
      URL<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>workerScript<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>worker <span class="token keyword">of</span> workers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  Atomics<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="75">
<li><span class="pn">Page 1466</span><strong>跨上下文消息</strong>：是一种<strong>在不同执行上下文（如不同工作线程或不同源的页面）间传递信息的能力</strong>。</li>
</ol>
<pre class="line-numbers language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- parent.html --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://localhost:3000/child.html<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> iframeWin <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contentWindow<span class="token punctuation">;</span>
      iframeWin<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'A secret'</span><span class="token punctuation">,</span> <span class="token string">'http://localhost:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> event <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Received from iframe... </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- child.html --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> event <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>origin <span class="token operator">===</span> <span class="token string">'http://localhost:3000'</span> <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Iframe received... </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        event<span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Confirmed!'</span><span class="token punctuation">,</span> <span class="token string">'http://localhost:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="76">
<li><span class="pn">Page 1469</span><strong>Encoding API</strong>：用于实现<strong>字符串与 TypedArray 之间的转换</strong>（<em>Firefox 与 Safari 不支持</em>）。</li>
</ol>
<ul>
<li><em><strong>TextEncoder</strong></em>；</li>
<li><em><strong>TextEncoderStream</strong></em>；</li>
<li><em><strong>TextDecoder</strong></em>；</li>
<li><em><strong>TextDecoderStream</strong></em>。</li>
</ul>
<ol start="77">
<li><span class="pn">Page 1480</span><strong>File API</strong> 与 <strong>Blob API</strong>：</li>
</ol>
<ul>
<li><em><strong>FileReader</strong></em>：表示一种<strong>异步</strong>文件读取机制；<ul>
<li><i>readAsText(file, encoding)</i>：读取纯文本内容；</li>
<li><i>readAsDataURL(file)</i>：读取文件内容，转换为 “data:URL” 格式；</li>
<li><i>readAsBinaryString(file)</i>：读取原始二进制格式内容；</li>
<li><i>readAsText(file)</i>：读取文件内容，并存放到 ArrayBuffer 中。</li>
</ul>
</li>
<li><em><strong>FileReaderSync</strong></em>：表示一种同步文件读取机制（只可在 Worker 中使用）；</li>
<li><strong>Blob</strong>（binary large object）表示“二进制大对象”，是 JavaScript <strong>对不可修改二进制数据的封装类型</strong>；</li>
<li><strong>对象 URL</strong>：有时也称为 “Blob URL”，是指<strong>引用存储在 File 或 Blob 中数据的 URL</strong>（这个 URL 可以直接当成普通 URL 来使用，两者均引用了某一种资源）。<code>window.URL.createObjectURL(object)</code> 可用于<strong>创建</strong>对象 URL 引用；<code>window.URL.revokeObjectURL(objectURL)</code> 用于<strong>释放</strong>对象 URL 引用。</li>
</ul>
<ol start="78">
<li><span class="pn">Page 1491</span>媒体元素 &amp; HTML5 拖放：（略）；</li>
<li><span class="pn">Page 1513</span><strong>Notifications API</strong>：</li>
</ol>
<pre class="line-numbers language-javascript"><code class="language-javascript">Notification<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>p <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">===</span> <span class="token string">'granted'</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Notification enabled.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> noti <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">'Congrats!'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  body<span class="token punctuation">:</span> <span class="token string">'You won $1000!'</span><span class="token punctuation">,</span>
  vibrate<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// lifecycles.</span>
noti<span class="token punctuation">.</span>onshow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Notification was shown!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
noti<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Notification was clicked!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
noti<span class="token punctuation">.</span>onclose <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Notification was closed!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
noti<span class="token punctuation">.</span>onerror <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Notification experienced an error!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="80">
<li><span class="pn">Page 1517</span>Page Visibility API：（略）；</li>
<li><span class="pn">Page 1518</span><strong>Streams API</strong>：</li>
</ol>
<ul>
<li><strong>可读流</strong>：是<strong>对底层数据源的封装</strong>。底层数据源可以将数据填充到流中，允许消费者通过流的公共接口读取数据；</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">ints</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> readableStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReadableStream</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">start</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">let</span> chunk <span class="token keyword">of</span> <span class="token function">ints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// enqueue the data of this stream.</span>
      controller<span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> readableStreamDefaultReader <span class="token operator">=</span> readableStream<span class="token punctuation">.</span><span class="token function">getReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// locked.</span>
<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// read data from the queue of this stream.</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> done<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> readableStreamDefaultReader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>可写流</strong>：是<strong>底层数据槽的封装</strong>。底层数据槽处理通过流的公共接口写入的数据；</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> writableStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WritableStream</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">write</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> writableStreamDefaultWriter <span class="token operator">=</span> writableStream<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">let</span> chunk <span class="token keyword">of</span> <span class="token function">ints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> writableStreamDefaultWriter<span class="token punctuation">.</span>ready<span class="token punctuation">;</span>
    writableStreamDefaultWriter<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>    
  <span class="token punctuation">}</span>
  writableStreamDefaultWriter<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>转换流</strong>：用于<strong>组合“可读流”与“可写流”</strong>。数据在两个流之间的转换是通过 transform 方法完成的；</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// return two kinds of stream.</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> writable<span class="token punctuation">,</span> readable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransformStream</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">transform</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    controller<span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span>chunk <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>管道</strong>：可用于<strong>连接流</strong>。<ul>
<li>*ReadableStream.pipeThrough(transformStream)*：可用于将 ReadableStream 接入 TransformStream；</li>
<li>*ReadableStream.pipeTo(writableStream)*：（同上）但无法进行“链式调用”。仅适用于链式调用最后是一个 WritableStream 的情况。</li>
</ul>
</li>
</ul>
<ol start="82">
<li><span class="pn">Page 1535</span><strong>计时 API</strong>；</li>
</ol>
<ul>
<li><em>High Resolution Time API</em>；<ul>
<li><code>window.performance.now()</code>：返回一个<strong>微秒</strong>精度的浮点值。计时器在执行上下文创建时从 0 开始单调递增；</li>
</ul>
</li>
<li><em>Performance Timeline API</em>；</li>
<li><em>Navigation Timing API</em>；</li>
<li><em>User Timing API</em>；</li>
<li><em>Resource Timing API</em>；</li>
<li><em>Paint Timing API</em>。</li>
</ul>
<ol start="83">
<li><span class="pn">Page 1545</span>Web Component：（略）；</li>
<li><span class="pn">Page 1578</span>Web Cryptography API：（略）；</li>
</ol>
<h3 id="第-21-章-错误处理与调试"><a href="#第-21-章-错误处理与调试" class="headerlink" title="第 21 章 - 错误处理与调试"></a>第 21 章 - 错误处理与调试</h3><ol start="85">
<li><span class="pn">Page 1610</span>错误处理：</li>
</ol>
<ul>
<li><code>return</code> 语句<strong>无法阻止 try-catch 语句中 finally 块的执行</strong>；</li>
<li><strong>自定义错误类型</strong>：</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">CustomError</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'CustomError'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CustomError</span><span class="token punctuation">(</span><span class="token string">'My error message.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>全局的错误处理程序（表现依浏览器不同而有差异）：</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript">window<span class="token punctuation">.</span>onerror <span class="token operator">=</span> <span class="token punctuation">(</span>message<span class="token punctuation">,</span> url<span class="token punctuation">,</span> line<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>考虑兼容性的<strong>错误上报函数</strong>（也可用来跨域）：<ul>
<li>所有浏览器都支持 Image 对象；</li>
<li>不受跨域规则限制；</li>
<li>记录错误过程很少出错（省去调用库的过程）。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> logError <span class="token operator">=</span> <span class="token punctuation">(</span>sev<span class="token punctuation">,</span> msg<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> encodedSev <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>sev<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> encodedMsg <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token string">`log.php?sev=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>encodedSev<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;msg=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>encodedMsg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="86">
<li><span class="pn">Page 1637</span>代码调试：</li>
</ol>
<ul>
<li>使用关键字 <code>debugger</code> 设置调试断点；</li>
</ul>
<h3 id="第-22-章-处理-XML"><a href="#第-22-章-处理-XML" class="headerlink" title="第 22 章 - 处理 XML"></a>第 22 章 - 处理 XML</h3><p>（略）</p>
<h3 id="第-23-章-JSON"><a href="#第-23-章-JSON" class="headerlink" title="第 23 章 - JSON"></a>第 23 章 - JSON</h3><ol start="87">
<li><span class="pn">Page 1672</span><strong>JSON</strong>：<em>JavaScript Object Notation</em>；</li>
</ol>
<ul>
<li>JSON 是 JavaScript 语法的子集；</li>
<li>第一代 Web 服务很大程度上是以 <strong>XML</strong> 为基础的，以服务器间通信为主要特征；</li>
<li>最简单的 JSON 可以是一个数值，或一个<strong>双引号</strong>的字符串；</li>
<li>两个方法：<ul>
<li><i>JSON.parse(text[, reviver])</i>；</li>
<li><i>JSON.stringify(value[, replacer [, space]])</i>。</li>
</ul>
</li>
</ul>
<h3 id="第-24-章-网络请求与远程资源"><a href="#第-24-章-网络请求与远程资源" class="headerlink" title="第 24 章 - 网络请求与远程资源"></a>第 24 章 - 网络请求与远程资源</h3><ol start="88">
<li><span class="pn">Page 1692</span>XMLHttpRequest：（略）；</li>
<li><span class="pn">Page 1710</span>CORS：（略）；</li>
<li><span class="pn">Page 1718</span><strong>Fetch API</strong>：</li>
</ol>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/json'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  body<span class="token punctuation">:</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  headers<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="91">
<li><span class="pn">Page 1771</span><strong>Beacon API</strong>:</li>
</ol>
<ul>
<li>会发送一个 POST 请求，可以在任何时间调用。主要<strong>用于满足统计和诊断代码的需要</strong>，这些代码通常尝试在<strong>卸载（unload）文档</strong>之前向 Web 服务器发送数据；</li>
<li>状态码、超时和其他网络原因造成的失败是不透明的，无法通过编程方式处理。</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token string">"/log"</span><span class="token punctuation">,</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    date<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="92">
<li><span class="pn">Page 1774</span>Web Socket：（略）；</li>
</ol>
<h3 id="第-25-章-客户端存储"><a href="#第-25-章-客户端存储" class="headerlink" title="第 25 章 - 客户端存储"></a>第 25 章 - 客户端存储</h3><ol start="93">
<li><span class="pn">Page 1798</span>JavaScript Document.cookie API 无法访问带有 <strong>HttpOnly</strong> 属性的 Cookie；此类 Cookie 仅作用于服务器。例如，持久化服务器端会话的 Cookie 不需要对 JavaScript 可用，而应具有 HttpOnly 属性。此预防措施有助于缓解跨站点脚本（XSS）攻击；</li>
</ol>
<h3 id="第-26-章-模块"><a href="#第-26-章-模块" class="headerlink" title="第 26 章 - 模块"></a>第 26 章 - 模块</h3><ol start="94">
<li><span class="pn">Page 1830</span><strong>模块系统</strong>：</li>
</ol>
<ul>
<li>本质上是“<strong>键/值实体</strong>”，其中每个模块都有个可用于<strong>引用它的标识符</strong>（如：字符串、模块文件路径）；</li>
<li>模块的依赖搜索可以通过 DFS 进行（被依赖的模块会最先执行）；</li>
<li>早期 <strong>IIFE 模式的模块</strong>：</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">let</span> Foo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    bar<span class="token punctuation">:</span> <span class="token string">'baz'</span><span class="token punctuation">,</span>
    baz<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
Foo<span class="token punctuation">.</span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>中期的模块规范：Commonjs、AMD、CMD；</li>
<li><strong>ES6 模块规范</strong>：<ul>
<li>默认情况下模块文件的<strong>下载会在遇到 &lt;script&gt; 标签时立即执行，而执行会延迟到文档解析完毕</strong>。嵌入模块通常仅适合作为入口模块；</li>
<li>模块代码只能在加载后执行；</li>
<li>模块只能加载一次；</li>
<li>模块时单例；</li>
<li>模块可以定义公共接口，其他模块可以基于这个公共接口观察和交换；</li>
<li>支持循环依赖；</li>
<li>默认在<strong>严格模式</strong>下执行；</li>
<li>不共享全局命名空间；</li>
<li>模块顶级 this 值为 undefined；</li>
<li>模块是异步加载和执行的。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 通过标签引入/构建模块 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">
  <span class="token comment" spellcheck="true">// module implementation.</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>module.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>ES6 模块导出</strong>：<ul>
<li><code>export</code> 关键字必须在模块<strong>顶级作用域</strong>；</li>
<li>命名导出和默认导出可以同时存在。</li>
</ul>
</li>
<li><strong>ES6 模块导入</strong>：<ul>
<li><code>import</code> 关键字必须在模块<strong>顶级作用域</strong>；</li>
<li>对于默认导出，可以使用 <code>default</code> 关键字并提供别名来导入。</li>
</ul>
</li>
</ul>
<h3 id="第-27-章-工作者线程"><a href="#第-27-章-工作者线程" class="headerlink" title="第 27 章 - 工作者线程"></a>第 27 章 - 工作者线程</h3><ol start="95">
<li><span class="pn">Page 1873</span>三种 Worker 类型：</li>
</ol>
<ul>
<li>（<strong>Worker</strong>）<em><strong>专用 Worker</strong></em>：普通 Web Worker；<ul>
<li><strong>隐式使用了 MessagePorts 在两个上下文之间的通信</strong>；</li>
<li>对应全局对象 DedicatedWorkerGlobalScope（继承自 WokerGlobalScope）；<ul>
<li><em>name</em>：可选的字符串标识符；</li>
<li><i>postMessage()</i>：向父上下文发送消息；</li>
<li><i>close()</i>：终止当前工作线程，<strong>非同步停止</strong>，仅会<strong>通知工作者线程取消事件循环中的所有任务</strong>；</li>
<li><i>importScripts()</i>：用于向工作线程导入任意数量的脚本（将按引用顺序同步执行）。</li>
</ul>
</li>
<li>必须使用<strong>同源脚本</strong>创建 Worker，而可以使用 <code>importScripts()</code> 在工作线程内部再<strong>加载其他源的脚本</strong>，并且该过程可以跨域；</li>
<li><code>Worker</code> 对象支持的事件处理程序属性和方法：<ul>
<li><em>onerror</em>：工作线程发生 ErrorEvent 类型错误事件时调用；</li>
<li><em><strong>onmessage</strong></em>：工作线程向父上下文发送消息时调用；</li>
<li><em>onmessageerror</em>：工作线程接收到无法反序列化的消息时发生；</li>
<li><i>postMessage()</i>：异步地向工作线程发送消息；</li>
<li><i>terminate()</i>：<strong>立即</strong>终止工作线程。一旦调用，工作线程的消息队列就会被清理并锁住；</li>
</ul>
</li>
</ul>
</li>
<li>（<strong>SharedWorker</strong>）<em><strong>共享 Worker</strong></em>：可以<strong>被多个不同的上下文使用</strong>，包括不同的页面（比如用一个共享线程管理多个同源页面 WebSocket 消息的发送与接收）；<ul>
<li>对应全局对象 SharedWorkerGlobalScope（继承自 WokerGlobalScope）；<ul>
<li><em>name</em>：可选的字符串标识符；</li>
<li><i>importScripts()</i>：用于向共享线程导入任意数量的脚本；</li>
<li><i>close()</i>：<strong>立即</strong>终止共享线程（前提是没有已连接端口）；</li>
<li><em><strong>onconnect</strong></em>：与共享线程<strong>建立连接时触发，包含连接页面的端口号</strong>。</li>
</ul>
</li>
<li>每一个共享线程的<strong>标识</strong>源自解析后的<strong>脚本 URL</strong>、<strong>工作者线程名称</strong>和<strong>文档源</strong>（同源页面下相同标识的共享线程将仅会创建一次）；</li>
</ul>
</li>
<li>（<strong>ServiceWorker</strong>）<em><strong>服务 Worker</strong></em>：主要用于<strong>拦截、重定向和修改页面发出的请求</strong>（详情略）。<ul>
<li>对应全局对象 ServiceWorkerGlobalScope（继承自 WokerGlobalScope）；</li>
</ul>
</li>
</ul>
<ol start="96">
<li><span class="pn">Page 1902</span>三种<strong>在上下文间转移信息的方式</strong>：</li>
</ol>
<ul>
<li><em><strong>结构化克隆算法</strong></em>：在目标上下文中生成传递对象的一个<strong>副本</strong>；<ul>
<li>可以识别对象中包含的循环引用；</li>
<li>原型链不会被克隆。</li>
</ul>
</li>
<li><em><strong>可转移对象</strong></em>：可以把所有权从一个上下文<strong>转移</strong>到另一个上下文；<ul>
<li>可转移类型：<ul>
<li><em>ArrayBuffer</em>；</li>
<li><em>MessagePort</em>；</li>
<li><em>ImageBitmap</em>；</li>
<li><em>OffscreenCanvas</em>；</li>
</ul>
</li>
</ul>
</li>
<li><em><strong>共享数组缓冲区</strong></em>：SharedArrayBuffer。</li>
</ul>
<h3 id="第-28-章-最佳实践"><a href="#第-28-章-最佳实践" class="headerlink" title="第 28 章 - 最佳实践"></a>第 28 章 - 最佳实践</h3><ol start="97">
<li><span class="pn">Page 2013</span>性能：</li>
</ol>
<ul>
<li><strong>访问全局变量始终比访问局部变量慢</strong>，因为前者需要遍历作用域链（全局变量在最外层）。优化办法是：尽量<strong>在局部作用域保存高层作用域的引用</strong>，比如 document 对象；</li>
<li>不使用 with 语句（会增长代码的作用域链）；</li>
<li>（循环展开）<strong>达夫设备</strong>：<strong>以 8 的倍数作为迭代次数</strong>而将循环展开为一系列语句；</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> process <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// do some work here.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> iterations <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>values<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> leftover <span class="token operator">=</span> values<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">8</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>leftover <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">--</span>leftover <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
  <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>iterations <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>一次声明多个变量（减少关键字识别过程）；</li>
<li>插入迭代性值（自增/自减与其他语句组合使用）；</li>
<li>使用数组和对象字面量；</li>
<li>（DOM）尽量减少访问 HTMLCollection 对象；</li>
<li>（DOM）使用 innerHTML（尽量保证一次性更新）；</li>
<li>（DOM）使用“<strong>事件委托</strong>”；</li>
</ul>
<h3 id="附录-A-ES2018-和-ES2019"><a href="#附录-A-ES2018-和-ES2019" class="headerlink" title="附录 A - ES2018 和 ES2019"></a>附录 A - ES2018 和 ES2019</h3><ol start="98">
<li><span class="pn">Page 2049</span>同步/异步迭代器：</li>
</ol>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Emitter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>max <span class="token operator">=</span> max<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>syncIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>asyncIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token operator">*</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>syncIdx <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> <span class="token keyword">this</span><span class="token punctuation">.</span>syncIdx<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">async</span> <span class="token operator">*</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>asyncIterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>asyncIdx <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>syncIdx<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Emitter</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> x <span class="token keyword">of</span> emitter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> x <span class="token keyword">of</span> emitter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>for-await-of 循环可以<strong>同时处理同步与异步可迭代对象</strong>；</li>
<li>异步迭代器会<strong>保证每次迭代时，代码的按顺序执行</strong>（即使后面的值先于前面的值解决）；</li>
<li>被拒绝的 Promise 会导致异步迭代器提前退出；</li>
</ul>
<h3 id="ECMAScript-不一致性记录（部分出于“兼容性”原因）"><a href="#ECMAScript-不一致性记录（部分出于“兼容性”原因）" class="headerlink" title="ECMAScript 不一致性记录（部分出于“兼容性”原因）"></a>ECMAScript 不一致性记录（部分出于“兼容性”原因）</h3><ol>
<li><code>typeof null</code> 结果为 object；</li>
<li><code>typeof NaN</code> 结果为 number（虽然为了保持 IEEE-754 定义上的一致性，但作为动态语言，可以在 Runtime 实现层进行语义优化）；</li>
<li><code>parseInt(&quot;0o10&quot;)</code> 八进制无法得到正确的结果，与十六进制形式 <code>parseInt(&quot;0x10&quot;)</code> 不统一；</li>
<li><code>String.prototype.substr</code> 与 <code>String.prototype.substring</code> 从函数名上无法区分差异性；</li>
<li><code>Array</code> 与 <code>new Array</code> 的结果一致，但对于其他结构化类型，则必须使用 new 关键字进行初始化，否则会抛出 TypeError；</li>
<li>ES5（empty）和 ES6（undefined）方法对待数组空位的不同。</li>
</ol>
<br><div class="article-bottom-meta"><span class="post-meta">Last built on<time itemprop="dateModified" datetime="2020-12-24T12:45:46.000Z"> 2025 / 04 / 08, 10:31:32</time></span></div></div></article><br><span class="next-post"><a href="/2020/12/25/《计算的本质：深入剖析程序和计算机》读书笔记（第-1-2-章）/" itemprop="url">下一篇 ⇒</a></span><span class="prev-post"><a href="/2020/12/18/《JavaScript-高级程序设计（第四版）》读书笔记（第-12-17-章）/" itemprop="url">⇐ 上一篇</a></span><br><section id="comments"><h4>评论 | Comments</h4><br><div class="comment-container"><div class="loading-mask">Loading ...</div><script src="https://utteranc.es/client.js" repo="Becavalier/utterances-comments" issue-term="title" label="[Comment]" theme="github-light" crossorigin="anonymous" async></script></div></section><br><br></main><script src="/scripts/index.js" type="text/javascript"></script></body></html>